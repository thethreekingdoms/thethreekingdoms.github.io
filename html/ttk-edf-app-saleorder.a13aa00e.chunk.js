webpackJsonp([8],{566:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,n=m(r(0)),u=m(r(10)),o=m(r(7)),i=m(r(9)),c=m(r(11)),s=m(r(12)),d=r(1),f=(m(d),m(r(14)),r(34)),l=m(r(217));function m(e){return e&&e.__esModule?e:{"default":e}}var p=(0,f.wrapper)(l["default"])(a=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,u["default"])(t)).apply(this,arguments))}return(0,s["default"])(t,e),(0,i["default"])(t,[{key:"render",value:function(){return this.props.monkeyKing((0,n["default"])({},this.props,{path:"root"}))}}]),t}(d.Component))||a;t["default"]=p,e.exports=t["default"]},567:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=h(r(0)),d=h(r(4)),o=h(r(84)),a=h(r(85)),n=h(r(7)),i=h(r(9));t["default"]=function(e){var t=new s.action(e),r=p["default"].actionCreator((0,u["default"])({},e,{metaAction:t})),a=new x((0,u["default"])({},e,{metaAction:t,extendAction:r})),n=(0,u["default"])({},t,r.gridAction,a);return t.config({metaHandlers:n}),n};var c=h(r(1)),s=(h(r(14)),r(34)),f=h(r(162)),l=r(13),m=(h(r(15)),h(r(2))),p=h(r(609));function h(e){return e&&e.__esModule?e:{"default":e}}var x=function(){function t(e){var s=this;(0,n["default"])(this,t),this.onInit=function(e){var t=e.component,r=e.injections;s.extendAction.gridAction.onInit({component:t,injections:r}),s.component=t,(s.injections=r).reduce("init"),s.load()},this.load=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return{},e.next=3,s.webapi.deliveryOrder.init({id:s.component.props.deliveryOrderId});case 3:t=e.sent,s.injections.reduce("load",t);case 5:case"end":return e.stop()}},e,s)})),this.prev=(0,a["default"])(o["default"].mark(function e(){var t,r;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.metaAction.gf("data.form.id"),e.next=3,s.webapi.deliveryOrder.prev(t);case 3:(r=e.sent)&&s.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,s)})),this.next=(0,a["default"])(o["default"].mark(function e(){var t,r;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.metaAction.gf("data.form.id"),e.next=3,s.webapi.deliveryOrder.next(t);case 3:(r=e.sent)?s.injections.reduce("setForm",r):s.metaAction.toast("warn","已经到最后一张单据！");case 5:case"end":return e.stop()}},e,s)})),this.add=function(){s.injections.reduce("setForm")},this.del=(0,a["default"])(o["default"].mark(function e(){var t,r;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.metaAction.gf("data.form.id"),e.next=3,s.metaAction.modal("confirm",{title:"删除",content:"确认删除?"});case 3:if(!e.sent){e.next=10;break}return e.next=7,s.webapi.deliveryOrder.del({id:t});case 7:r=e.sent,s.metaAction.toast("success","删除单据成功"),s.injections.reduce("setForm",r);case 10:case"end":return e.stop()}},e,s)})),this.audit=(0,a["default"])(o["default"].mark(function e(){var t,r;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.metaAction.gf("data.form.id")){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,s.webapi.deliveryOrder.audit({id:t});case 5:(r=e.sent)&&s.injections.reduce("setForm",r);case 7:case"end":return e.stop()}},e,s)})),this.moreMenuClick=function(e){switch(e.key){case"del":s.del();break;case"receipt":s.metaAction.toast("warn","此功能为实现！");case"history":s.metaAction.toast("warn","此功能为实现！")}},this.setting=function(){s.metaAction.toast("warn","此功能为实现！")},this.save=(0,a["default"])(o["default"].mark(function e(){var t,r,a,n;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.metaAction.gf("data.form").toJS(),!(0<(r=s.checkSave(t)).length)){e.next=5;break}return s.metaAction.toast("error",c["default"].createElement("div",{style:{textAlign:"left"}},r.map(function(e){return c["default"].createElement("div",null,e)}))),e.abrupt("return");case 5:if(!t.id&&0!=t.id){e.next=12;break}return e.next=8,s.webapi.deliveryOrder.update(t);case 8:(a=e.sent)&&(s.metaAction.toast("success","保存单据成功"),s.injections.reduce("setForm",a)),e.next=16;break;case 12:return e.next=14,s.webapi.deliveryOrder.create(t);case 14:(n=e.sent)&&(s.metaAction.toast("success","保存单据成功"),s.injections.reduce("setForm",n));case 16:case"end":return e.stop()}},e,s)})),this.customerFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.customer.query();case 2:t=e.sent,s.metaAction.sf("data.other.customers",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.warehouseFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.warehouse.query();case 2:t=e.sent,s.metaAction.sf("data.other.warehouses",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.ticketTypeFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.ticketType.query();case 2:t=e.sent,s.metaAction.sf("data.other.ticketTypes",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.stockFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.stock.query();case 2:t=e.sent,s.metaAction.sf("data.other.stocks",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.taxRateFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.taxRate.query();case 2:t=e.sent,s.metaAction.sf("data.other.taxRates",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.settlementModeFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.settlementMode.query();case 2:t=e.sent,s.metaAction.sf("data.other.settlementModes",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.accountFocus=(0,a["default"])(o["default"].mark(function e(){var t;return o["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.webapi.assetAccount.query();case 2:t=e.sent,s.metaAction.sf("data.other.assetAccounts",(0,l.fromJS)(t));case 4:case"end":return e.stop()}},e,s)})),this.numberFormat=function(e,t){return!0===(2<arguments.length&&void 0!==arguments[2]&&arguments[2])?e:m["default"].number.format(e,t)},this.numberChange=function(i,c){return function(e){var t,r=m["default"].number.round(e,2),a=m["default"].number.round(c.price,2),n=m["default"].number.round(a*r,2),u=m["default"].number.round(n*(c.tax?c.tax.id:0)/100,2),o=m["default"].number.round(n+u,2);s.metaAction.sfs((t={},(0,d["default"])(t,"data.form.details."+i+".number",r),(0,d["default"])(t,"data.form.details."+i+".amount",n),(0,d["default"])(t,"data.form.details."+i+".tax",u),(0,d["default"])(t,"data.form.details."+i+".priceTaxTotal",o),t))}},this.priceChange=function(i,c){return function(e){var t,r=m["default"].number.round(e,2),a=m["default"].number.round(c.number,2),n=m["default"].number.round(r*a,2),u=m["default"].number.round(n*(c.tax?c.tax.id:0)/100,2),o=m["default"].number.round(n+u,2);s.metaAction.sfs((t={},(0,d["default"])(t,"data.form.details."+i+".price",r),(0,d["default"])(t,"data.form.details."+i+".amount",n),(0,d["default"])(t,"data.form.details."+i+".tax",u),(0,d["default"])(t,"data.form.details."+i+".priceTaxTotal",o),t))}},this.taxRateChange=function(o,i,c){return function(t){var e,r=c.find(function(e){return e.id==t});if(r){var a=i.amount,n=m["default"].number.round(a*r.id/100,2),u=m["default"].number.round(a+n,2);s.metaAction.sfs((e={},(0,d["default"])(e,"data.form.details."+o+".taxRate",(0,l.fromJS)(r)),(0,d["default"])(e,"data.form.details."+o+".tax",(0,l.fromJS)(n)),(0,d["default"])(e,"data.form.details."+o+".priceTaxTotal",u),e))}}},this.sumAmount=function(e){return s.numberFormat(s.sum(e,function(e,t){return e+t.amount}),2)},this.sumTax=function(e){return s.numberFormat(s.sum(e,function(e,t){return e+t.tax}),2)},this.sumPriceTaxTotal=function(e){return s.numberFormat(s.sum(e,function(e,t){return e+t.priceTaxTotal}),2)},this.calcBalance=function(e){var t=s.sum(e.form.details,function(e,t){return e+t.priceTaxTotal}),r=s.sum(e.form.settlements,function(e,t){return e+t.settlementAmount}),a=e.form.useAdvance?m["default"].number.round(e.form.advanceAmount,2):0;return s.numberFormat(t-r-a,2)},this.mousedown=function(e){s.extendAction.gridAction.mousedown(e)},this.gridKeydown=function(e){s.extendAction.gridAction.gridKeydown(e),40==e.keyCode&&s.extendAction.gridAction.cellAutoFocus()},this.metaAction=e.metaAction,this.extendAction=e.extendAction,this.config=f["default"].current,this.webapi=this.config.webapi}return(0,i["default"])(t,[{key:"checkSave",value:function(e){var r=[];return e.customer&&e.customer.id||r.push("客户不能为空!"),e.date||r.push("单据日期不能为空!"),e.warehouse&&e.warehouse.id||r.push("仓库不能为空!"),e.ticketType&&e.ticketType.id||r.push("仓库不能为空!"),e.details&&0!=e.details.length||r.push("明细不能为空！"),e.details.forEach(function(e,t){e.stock||r.push("明细第"+(t+1)+"行，存货不能为空！")}),r}},{key:"sum",value:function(e,a){return e&&0!=e.length?e.reduce(function(e,t){var r=a(e,t);return isNaN(r)?e:r},0):this.numberFormat(0,2)}}]),t}();e.exports=t["default"]},568:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=d(r(0)),a=d(r(7));t["default"]=function(e){var t=new u.reducer(e),r=i["default"].reducerCreator((0,n["default"])({},e,{metaReducer:t})),a=new f((0,n["default"])({},e,{metaReducer:t,extendReducer:r}));return(0,n["default"])({},t,r.gridReducer,a)};var c=r(13),u=r(34),o=d(r(162)),s=r(218),i=(d(r(15)),d(r(609)));function d(e){return e&&e.__esModule?e:{"default":e}}var f=function e(t){var i=this;(0,a["default"])(this,e),this.init=function(e,t){return i.metaReducer.init(e,(0,s.getInitState)())},this.load=function(e,t){var r=t.voucher,a=t.stocks,n=t.customers,u=t.ticketTypes,o=t.warehouses;return e=r?i.metaReducer.sf(e,"data.form",(0,c.fromJS)(r)):i.metaReducer.sf(e,"data",(0,c.fromJS)((0,s.getInitState)().data)),e=i.metaReducer.sf(e,"data.other.stocks",(0,c.fromJS)(a)),e=i.metaReducer.sf(e,"data.other.customers",(0,c.fromJS)(n)),e=i.metaReducer.sf(e,"data.other.ticketTypes",(0,c.fromJS)(u)),e=i.metaReducer.sf(e,"data.other.warehouses",(0,c.fromJS)(o))},this.setForm=function(e,t){return t?i.metaReducer.sf(e,"data.form",(0,c.fromJS)(t)):i.metaReducer.sf(e,"data.form",(0,c.fromJS)((0,s.getInitState)().data.form))},this.addRowBefore=function(e,t,r){return e},this.delRowBefore=function(e,t,r){return e},this.metaReducer=t.metaReducer,this.extendReducer=t.extendReducer,this.config=o["default"].current};e.exports=t["default"]},609:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=r(0),u=(a=n)&&a.__esModule?a:{"default":a},o=r(48);t["default"]={actionCreator:function(e){return{gridAction:new o.GridDecorator.action((0,u["default"])({},e,{gridOption:{details:{path:"data.form.details",selectFieldName:"selected",cellClassName:"mk-app-delivery-order-cell",emptyRow:{},getColNames:function(e){return["stockCode","stockName","spec","unit","isGift","number","price","amount","taxRate","tax","priceTaxTotal"]},cellIsReadonly:function(e,t,r){return 1==e.x||2==e.x||3==e.x||7==e.x||9==e.x||10==e.x}}}}))}},reducerCreator:function(e){return{gridReducer:new o.GridDecorator.reducer((0,u["default"])({},e,{gridOption:{details:{path:"data.form.details",selectFieldName:"selected",cellClassName:"mk-app-delivery-order-cell",emptyRow:{},getColNames:function(e){return["stockCode","stockName","spec","unit","isGift","number","price","amount","taxRate","tax","priceTaxTotal"]},cellIsReadonly:function(e,t,r){return 1==e.x||2==e.x||3==e.x||7==e.x||9==e.x||10==e.x}}}}))}}},e.exports=t["default"]}});