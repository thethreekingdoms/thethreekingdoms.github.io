webpackJsonp([4],{1066:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var n,r=m(a(0)),c=m(a(10)),i=m(a(7)),o=m(a(9)),u=m(a(11)),d=m(a(12)),s=a(2),l=(m(s),m(a(15)),a(34)),f=m(a(403));function m(e){return e&&e.__esModule?e:{"default":e}}var g=(0,l.wrapper)(f["default"])(n=function(e){function t(){return(0,i["default"])(this,t),(0,u["default"])(this,(t.__proto__||(0,c["default"])(t)).apply(this,arguments))}return(0,d["default"])(t,e),(0,o["default"])(t,[{key:"render",value:function(){return this.props.monkeyKing((0,r["default"])({},this.props,{path:"root"}))}}]),t}(s.Component))||n;t["default"]=g,e.exports=t["default"]},1067:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,h=s(a(0)),y=s(a(36)),b=s(a(40)),p=s(a(41)),C=s(a(16)),c=s(a(7)),i=s(a(9));t["default"]=function(e){var t=new d.action(e),a=u["default"].actionCreator((0,h["default"])({},e,{metaAction:t})),n=new l((0,h["default"])({},e,{metaAction:t,extendAction:a})),r=(0,h["default"])({},t,a.gridAction,n);return t.config({metaHandlers:r}),r};var A=s(a(2)),o=(s(a(15)),s(a(230))),x=s(a(13)),u=s(a(1109)),S=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}}(a(51)),T=a(1),R=s(T),d=a(34),I=(a(6),a(28)),D=a(14),E=a(63);function s(e){return e&&e.__esModule?e:{"default":e}}var l=(n=function(){function t(e){(0,c["default"])(this,t),r.call(this),this.metaAction=e.metaAction,this.extendAction=e.extendAction,this.config=o["default"].current,this.webapi=this.config.webapi}return(0,i["default"])(t,[{key:"getSubjectWithAuxName",value:function(e,t,a){if(!t.get("isCalc"))return e;var n="";t.get("isCalcCustomer")&&a.get("customer")&&a.get("customer").get("name")&&(n=n+"_"+a.get("customer").get("name")),t.get("isCalcSupplier")&&a.get("supplier")&&a.get("supplier").get("name")&&(n=n+"_"+a.get("supplier").get("name")),t.get("isCalcProject")&&a.get("project")&&a.get("project").get("name")&&(n=n+"_"+a.get("project").get("name")),t.get("isCalcDepartment")&&a.get("department")&&a.get("department").get("name")&&(n=n+"_"+a.get("department").get("name")),t.get("isCalcPerson")&&a.get("person")&&a.get("person").get("name")&&(n=n+"_"+a.get("person").get("name")),t.get("isCalcInventory")&&a.get("inventory")&&a.get("inventory").get("name")&&(n=n+"_"+a.get("inventory").get("name"));this.metaAction.gf("data.other.calcDict");for(var r=1;r<=10;r++)t.get("isExCalc"+r)&&a.get("exCalc"+r)&&a.get("exCalc"+r).get("name")&&(n=n+"_"+a.get("exCalc"+r).get("name"));return e+"_"+n}},{key:"checkVoucherDataBeforeSave",value:function(e){var l=this,f=[],m=!0,g=!1,h=this.metaAction.gf("data.form.details");if(this.backCaculateAmount(),e.code?/^\d+$/.test(e.code)||f.push("凭证号必须为纯数字，请修改"):f.push("凭证号不能为空"),"0"===e.code&&f.push("凭证号不能为0，请修改"),e.date||f.push("日期不能为空"),e.details.forEach(function(t,e){if(t&&(t.accountingSubject||t.summary||t.creditAmount||t.debitAmount)&&(t.accountingSubject||!t.summary||t.creditAmount||t.debitAmount)){m=!1;var a=(0,D.List)();if(t.summary||(a=a.push("摘要")),t.accountingSubject||(a=a.push("科目")),t.debitAmount||t.creditAmount||(a=a.push("金额")),0<a.size){var n=void 0;return n=2<a.size?"摘要、科目和金额":2==a.size?a.get(0)+"和"+a.get(1):a.get(0),void f.push("第"+(e+1)+"行，请填写"+n)}if(t.summary&&200<t.summary.length&&f.push("第"+(e+1)+"行，摘要输入过长，请调整"),t.accountingSubject.isCalcQuantity&&(!t.quantityAndForeignCurrency||!t.quantityAndForeignCurrency.amount)){var r=l.metaAction.gf("data.other.originalFieldPath"),c=r?r.split(",")[1]:-1,i=void 0;if(!r||c!=e)return void f.push("第"+(e+1)+"行，请填写数量核算");i=r&&-1!=r.indexOf("debitAmount")?"debitAmount":r&&-1!=r.indexOf("creditAmount")?"creditAmount":void 0,h=h.update(c,function(e){return e.setIn(["quantityAndForeignCurrency","amount"],t[i])}),g=!0}if(!t.accountingSubject.isCalcMulti||t.quantityAndForeignCurrency&&t.quantityAndForeignCurrency.currency){if(t.accountingSubject.isCalc){if(!t.accountingSubject.auxAccountSubjects)return void f.push("第"+(e+1)+"行，请填写科目辅助核算");var o=t.accountingSubject.auxAccountSubjects;if(t.accountingSubject.isCalcDepartment&&(!o.department||!o.department.id))return void f.push("第"+(e+1)+"行，请填写部门辅助核算");if(t.accountingSubject.isCalcPerson&&(!o.person||!o.person.id))return void f.push("第"+(e+1)+"行，请填写人员辅助核算");if(t.accountingSubject.isCalcCustomer&&(!o.customer||!o.customer.id))return void f.push("第"+(e+1)+"行，请填写客户辅助核算");if(t.accountingSubject.isCalcSupplier&&(!o.supplier||!o.supplier.id))return void f.push("第"+(e+1)+"行，请填写供应商辅助核算");if(t.accountingSubject.isCalcInventory&&(!o.inventory||!o.inventory.id))return void f.push("第"+(e+1)+"行，请填写存货辅助核算");if(t.accountingSubject.isCalcProject&&(!o.project||!o.project.id))return void f.push("第"+(e+1)+"行，请填写项目辅助核算");for(var u=l.metaAction.gf("data.other.calcDict"),d=1;d<=10;d++)if(t.accountingSubject["isExCalc"+d]&&(!o["exCalc"+d]||!o["exCalc"+d].id)){var s=u.get("isExCalc"+d);return void f.push("第"+(e+1)+"行，请填写"+s+"辅助核算")}}}else f.push("第"+(e+1)+"行，请填写外币核算")}}),g&&this.metaAction.sf("data.form.details",h),m)f.push("请填写凭证分录");else{var t=0,a=0,n=!0,r=!1,c=void 0;try{for(var i,o=(0,C["default"])(e.details);!(n=(i=o.next()).done);n=!0){var u=i.value,d=parseInt((100*parseFloat(u.debitAmount||0)).toFixed(0)),s=parseInt((100*parseFloat(u.creditAmount||0)).toFixed(0));t=(parseInt((100*t).toFixed(0))+d)/100,a=(parseInt((100*a).toFixed(0))+s)/100}}catch(e){r=!0,c=e}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw c}}t.toFixed(2)!==a.toFixed(2)&&f.push("凭证借贷不平")}return f}},{key:"sumInternal",value:function(e,n){return e&&0!=e.length?e.reduce(function(e,t){var a=n(e,t);return isNaN(a)?e:a},0):"0"}}]),t}(),r=function(){var t,a,n,r,c,i,o,u,d,s,l,f,m,g,v=this;this.onInit=function(e){var t=e.component,a=e.injections;v.extendAction.gridAction.onInit({component:t,injections:a}),v.component=t,(v.injections=a).reduce("init");var n=v.component.props.initData,r=v.component.props.addEventListener;r&&r("onTabFocus",v.onTabFocus.bind(v)),v.setrowsCount(),v.load(n)},this.load=(t=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getSubjectList();case 2:return a=e.sent,e.next=5,v.webapi.currency.queryList({entity:{isEnable:!0}});case 5:if(n=e.sent,r=v.getEnabledYearMonth(),t){e.next=14;break}return e.next=10,v.webapi.certificate.init({isReturnValue:!0});case 10:0==(c=e.sent).result&&c.error&&"70002"==c.error.code?(v.metaAction.toast("error",c.error.message),v.injections.reduce("initNewCertificate",void 0,a,r,n.list)):(v.injections.reduce("initNewCertificate",c,a,r,n.list),v.extendAction.gridAction.cellAutoFocus()),e.next=29;break;case 14:if(!t.id){e.next=21;break}return e.next=17,v.webapi.certificate.findById({docId:t.id});case 17:i=e.sent,v.injections.reduce("initLoadCertificate",(0,D.fromJS)(i),r,a,n.list),e.next=29;break;case 21:if(!t||!t.code){e.next=28;break}if("9999"!=t.code){e.next=25;break}return v.metaAction.toast("error","凭证号达到9999，不能再增加凭证！"),e.abrupt("return");case 25:v.checkEditStatusBeforeLoadNewVoucher(function(){t.isInsert=!0,v.injections.reduce("clearAndNewCertificate",t,a,n.list,r)}),e.next=29;break;case 28:t&&t.newCertificate&&v.checkEditStatusBeforeLoadNewVoucher((0,p["default"])(b["default"].mark(function e(){var t;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.webapi.certificate.init({isReturnValue:!0});case 2:0==(t=e.sent).result&&t.error&&"70002"==t.error.code?(v.metaAction.toast("error",t.error.message),v.injections.reduce("clearAndNewCertificate",{code:t.docCode,voucherDate:t.voucherDate},a,n.list,r)):(v.injections.reduce("clearAndNewCertificate",{code:t.docCode,voucherDate:t.voucherDate},a,n.list,r),v.extendAction.gridAction.cellAutoFocus());case 4:case"end":return e.stop()}},e,v)})));case 29:v.editCloseTips(!1);case 30:case"end":return e.stop()}},e,v)})),function(e){return t.apply(this,arguments)}),this.onTabFocus=(a=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i,o,u,d;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t?t.initData:void 0,e.next=3,v.getSubjectList();case 3:return n=e.sent,e.next=6,v.webapi.currency.queryList({entity:{isEnable:!0}});case 6:if(r=e.sent,!a||!a.id){e.next=11;break}v.checkEditStatusBeforeLoadNewVoucher((0,p["default"])(b["default"].mark(function e(){var t;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.webapi.certificate.findById({docId:a.id});case 2:t=e.sent,v.injections.reduce("initLoadCertificate",(0,D.fromJS)(t),void 0,n,r.list);case 4:case"end":return e.stop()}},e,v)}))),e.next=30;break;case 11:if(!a||!a.code){e.next=18;break}if("9999"!=a.code){e.next=15;break}return v.metaAction.toast("error","凭证号达到9999，不能再增加凭证！"),e.abrupt("return");case 15:v.checkEditStatusBeforeLoadNewVoucher(function(){a.isInsert=!0,v.injections.reduce("clearAndNewCertificate",a,n,r.list),v.extendAction.gridAction.cellAutoFocus()}),e.next=30;break;case 18:if(!a||!a.newCertificate){e.next=22;break}v.checkEditStatusBeforeLoadNewVoucher((0,p["default"])(b["default"].mark(function e(){var t;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.webapi.certificate.init({isReturnValue:!0});case 2:0==(t=e.sent).result&&t.error&&"70002"==t.error.code?(v.metaAction.toast("error",t.error.message),v.injections.reduce("clearAndNewCertificate",{code:t.docCode,voucherDate:t.voucherDate},n,r.list)):(v.injections.reduce("clearAndNewCertificate",{code:t.docCode,voucherDate:t.voucherDate},n,r.list),v.extendAction.gridAction.cellAutoFocus());case 4:case"end":return e.stop()}},e,v)}))),e.next=30;break;case 22:if(c=v.metaAction.gf("data.form.details"),i=v.metaAction.gf("data.other.editStatus"),v.upgradeDetails(c,n,(0,D.fromJS)(r.list)),i!=S.VIEW_STATUS){e.next=30;break}return o=v.metaAction.gf("data.form.id"),e.next=28,v.webapi.certificate.findById({docId:o,isReturnValue:!0});case 28:0==(u=e.sent).result&&u.error.code==S.NOT_FOUND_CERTIFICATE?v.newCertificate(n):(d=v.getEnabledYearMonth(),v.injections.reduce("initLoadCertificate",(0,D.fromJS)(u),d,n,r.list));case 30:case"end":return e.stop()}},e,v)})),function(e){return a.apply(this,arguments)}),this.windowClick=function(e){document.getElementsByClassName("fixedDataTableLayout_rowsContainer")&&v.injections.reduce("attachmentVisible",!1)},this.componentDidMount=function(){var e=window;e.addEventListener?(document.getElementById("app").addEventListener("click",v.windowClick,!1),document.body.addEventListener("keydown",v.bodyKeydownEvent,!1)):e.attachEvent&&(document.getElementById("app").attachEvent("onclick",v.windowClick),document.body.attachEvent("onkeydown",v.bodyKeydownEvent))},this.bodyKeydownEvent=function(e){var t=document.getElementById("ttk-voucher-app-document"),a=document.getElementsByClassName("ant-modal-body");t&&a&&a.length<1&&v.keyDownCickEvent({event:e})},this.onMouseDown=function(e){var t=R["default"].path.findPathByEvent(e);if(-1<t.indexOf("cell.cell.dropdownFooter.add"))return!0;-1!=t.indexOf(".cell.cell,")&&v.extendAction.gridAction.mousedown(e)},this.getSubjectList=(0,p["default"])(b["default"].mark(function e(){var t,a;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.webapi.accountingSubject.query({isEndNode:!0});case 2:return t=e.sent,a=[],t.glAccounts.map(function(e){e.isEnable&&a.push(e)}),t.glAccountsAll=t.glAccounts,t.glAccounts=a,e.abrupt("return",t);case 8:case"end":return e.stop()}},e,v)})),this.setrowsCount=function(){var e=document.getElementsByClassName("edfx-app-portal-content-main"),t=v.metaAction.gf("data").toJS().form.details,a=t.length,n=void 0,r=[];if(0!=e.length){n=e[0].clientHeight-311,a=5<Math.ceil(n/60)?Math.ceil(n/60):5;var c={summary:"",accountingSubject:void 0,debitAmount:void 0,creditAmount:""};r=Array(a-5).fill(c)}t=t.concat(r),v.injections.reduce("setrowsCount",t,t.length)},this.keyDownCickEvent=function(e){if(e&&e.event){var t=e.event;t.ctrlKey&&t.altKey&&("n"==t.key||78==t.keyCode)?(v.isDisplayButton("add")&&v.newCertificate(),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()):!t.ctrlKey||t.altKey||"s"!=t.key&&83!=t.keyCode?!t.ctrlKey||t.altKey||"/"!=t.key&&191!=t.keyCode?!t.ctrlKey||t.altKey||"y"!=t.key&&89!=t.keyCode?!t.ctrlKey||t.altKey||";"!=t.key&&186!=t.keyCode?"Enter"!=t.key&&13!=t.keyCode||"root.children.formHeader.children.date.children.date"!=v.metaAction.gf("data.other.focusFieldPath")?-1!==navigator.userAgent.indexOf("Mac OS X")?t.ctrlKey||t.altKey||""!=t.key&&8!=t.keyCode&&46!=t.keyCode?!t.ctrlKey||t.altKey||"["!=t.key&&219!=t.keyCode?!t.ctrlKey||t.altKey||"]"!=t.key&&221!=t.keyCode||v.loadNextCertificate():v.loadPrevCertificate():v.metaAction.gf("data.other.btnStatus")||v.isDisplayButton("del")||v.del():t.ctrlKey||t.altKey||"Delete"!=t.key&&46!=t.keyCode?!t.ctrlKey||t.altKey||"["!=t.key&&37!=t.keyCode&&219!=t.keyCode?!t.ctrlKey||t.altKey||"]"!=t.key&&39!=t.keyCode&&221!=t.keyCode||v.loadNextCertificate():v.loadPrevCertificate():v.metaAction.gf("data.other.btnStatus")||v.isDisplayButton("del")||v.del():v.metaAction.sf("data.other.focusFieldPath","root.children.formHeader.children.attachment.children.attachment"):v.isDisplayButton("print")&&v.print():(v.isDisplayButton("audit")&&v.audit(),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()):(!v.metaAction.gf("data.other.btnStatus")&&v.isDisplayButton("save")&&(v.backCaculateAmount(),v.saveAndNew()),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()):(!v.metaAction.gf("data.other.btnStatus")&&v.isDisplayButton("save")&&(v.backCaculateAmount(),v.save()),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation())}},this.componentWillReceiveProps=function(e){e.keydown},this.selfGridKeydown=function(e){0<document.getElementsByClassName("accountQuantityEdit").length&&-1<document.activeElement.className.indexOf("ant-select-selection")||(v.keyDownCickEvent({event:e}),v.extendAction.gridAction.gridKeydown(e),40==e.keyCode&&v.extendAction.gridAction.cellAutoFocus())},this.upgradeDetails=function(e,t,a){var n=void 0,r=void 0,c=void 0,i=void 0,o=(0,D.fromJS)(t.glAccounts),u=v.metaAction.gf("data.other.editStatus");v.metaAction.sf("data.other.calcDict",(0,D.Map)(t.calcDict)),v.metaAction.sf("data.other.accountingSubjects",(0,D.fromJS)(t.glAccounts)),v.metaAction.sf("data.other.accountingSubjectsAll",(0,D.fromJS)(t.glAccountsAll)),v.metaAction.sf("data.other.currencyDS",a);for(var d=0;d<e.size;d++)if(n=e.get(d).get("accountingSubject"),i=e.get(d).get("quantityAndForeignCurrency")?e.get(d).get("quantityAndForeignCurrency").toJS():void 0,a&&n&&i&&i.currency&&(c=i.currency.id!=n.get("currencyId")?a.find(function(e){return e.get("id")==i.currency.id}):a.find(function(e){return e.get("id")==n.get("currencyId")})),i&&!c&&(i.currency=null,e=e.update(d,function(e){return e.set("quantityAndForeignCurrency",(0,D.fromJS)(i))})),null!=n)if(r=o.filter(function(e){return e.get("id")==n.get("id")}).toArray(),u==S.ADD_STATUS&&null!=n.get("balance")&&(r[0]=r[0].set("balance",n.get("balance")).set("initBalance",n.get("balance"))),n.get("isCalc")&&r[0]&&!r[0].get("isCalc")||!n.get("isCalc")&&r[0]&&r[0].get("isCalc"))n=r[0],e=e.update(d,function(e){return e.set("accountingSubject",r[0])});else if(n.get("isCalc")&&r[0]&&r[0].get("isCalc")){var s=n.get("auxAccountSubjects"),l=n.get("auxAccountSubjectsPreSelected");r[0]=r[0].set("auxAccountSubjects",s),r[0]=r[0].set("auxAccountSubjectsPreSelected",l),e=e.update(d,function(e){return e.set("accountingSubject",r[0])})}else n.get("isCalc")||!r[0]||r[0].get("isCalc")||(e=e.update(d,function(e){return e.set("accountingSubject",r[0])}));v.metaAction.sf("data.form.details",e)},this.getEnabledYearMonth=function(){var e=v.metaAction.context.get("currentOrg");return e.enabledYear+"-"+e.enabledMonth.toString().padStart(2,"0")},this.getCurrentUser=function(){return v.metaAction.context.get("currentUser")},this.isDisplayButton=function(e){var t=v.metaAction.gf("data.other.editStatus"),a=v.metaAction.gf("data.form.certificateStatus"),n=!0;return"add"==e?n=t==S.VIEW_STATUS:"del"==e?n=a==S.STATUS_VOUCHER_AUDITED||a==S.STATUS_VOUCHER_NOT_AUDITED&&t!=S.VIEW_STATUS:"save"==e?n=t!=S.VIEW_STATUS:"audit"==e?n=t==S.VIEW_STATUS:"print"==e?n=t==S.VIEW_STATUS:"more"==e&&(n=t!=S.ADD_STATUS),n},this.getDynamicComponent=function(e){var t=v.metaAction.isReadOnly(e),a=v.isFocusOnAccount(e),n=v.metaAction.gf("data.other.focusFieldPath"),r=v.metaAction.gf("data.other.cancelEditAuxAccount"),c=0;return n?(-1!=n.indexOf(".cell.cell")&&(c=n.split(".cell.cell,")[1]),e?-1<e.indexOf(".cell.cell,"+c)?t?"SubjectDisplay":a||r?(v.metaAction.sf("data.other.cancelEditAuxAccount",null),"Select"):"SubjectDisplay":"SubjectDisplay":void 0):"SubjectDisplay"},this.getDisabledDate=function(e){var t=new Date(v.metaAction.gf("data.other.disabledDate"));return e&&e.valueOf()<t},this.isFocusOnAccount=function(e){var t=document.getElementById("auxItemConfirm");return v.metaAction.isFocus(e)&&(null==t||null==t)},this.onFieldFocus=(n=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i,o,u,d,s,l,f,m,g,h,p,A,S;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(-1<t.indexOf("root.children.details.columns.summary"))){e.next=13;break}return a=parseInt(t.split(",")[1]),v.metaAction.gf("data.form.details").get(a),v.backCaculateAmount(),e.next=5,v.webapi.summary.query();case 5:return n=e.sent,e.next=8,v.webapi.commonDoc.query();case 8:r=e.sent,v.metaAction.sf("data.other.summarys",(0,D.fromJS)([].concat((0,y["default"])(n.summarys),(0,y["default"])(v.translateTemplate(r))))),v.extendAction.gridAction.cellAutoFocus(),e.next=14;break;case 13:-1<t.indexOf("accountingSubject")&&(c=parseInt(t.split(",")[1]),i=v.metaAction.gf("data.form.details").get(c),(o=i.get("accountingSubject"))&&(u=o.get("codeAndName"),d=o.get("id"),s=document.getElementsByClassName("ant-select-selection-selected-value"),l=v.metaAction.gf("data.other.accountingSubjects"),f=l.find(function(e){return e.get("id")==d}),m=o.get("auxAccountSubjectsPreSelected"),f||s&&0<s.length&&(g=v.getSubjectWithAuxName(u,o,m),s[0].innerHTML=g,s[0].title=g)),v.backCaculateAmount());case 14:if(v.injections.reduce("onFieldFocus",t),null==v.metaAction.gf("data.other.originalFieldPath")&&v.metaAction.sf("data.other.originalFieldPath",t),v.isVisibleQuanAndCurrCom())for(h=document.getElementsByClassName("btnQuantityCancel"),p=h.length-1;-1<p;p--)A=h[p],(S=h[p].parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement)&&-1==S.className.indexOf("ant-popover-hidden")&&A&&A.click();case 17:case"end":return e.stop()}},e,v)})),function(e){return n.apply(this,arguments)}),this.backCaculateAmount=function(){if(v.metaAction.gf("data.other.originalFieldPath")){var e=v.metaAction.gf("data.other.originalFieldPath"),t=e.split(",")[1],a=v.metaAction.gf("data.form.details").get(t);if(!a)return;var n=a.get("quantityAndForeignCurrency");if(!n)return;var r=n.get("amount"),c=v.metaAction.gf("data.other.originalFieldPath"),i=void 0;(i=c&&-1!=c.indexOf("debitAmount")?"debitAmount":c&&-1!=c.indexOf("creditAmount")?"creditAmount":void 0)&&r!=a.get(i)&&v.injections.reduce("onEvent","onBlur",{path:e})}},this.isVisibleQuanAndCurrCom=function(){var e=!1;if(document.getElementsByClassName){var t=document.getElementsByClassName("accountQuantityEdit")[0],a=document.getElementsByClassName("ant-popover");if(t&&a&&0<a.length)for(var n=0;n<a.length;n++)if(a[n]&&-1==a[n].className.indexOf("ant-popover-hidden")){e=!0;break}}return e},this.onEvent=(r=(0,p["default"])(b["default"].mark(function e(t,a){var n,r,c,i;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.path){e.next=2;break}return e.abrupt("return");case 2:if("accountQuantityIsShow"!==t){e.next=7;break}v.injections.reduce("accountQuantityIsShow",a),v.extendAction.gridAction.cellAutoFocus(),e.next=26;break;case 7:if("cancelEditAuxAccount"!==t){e.next=13;break}v.injections.reduce("cancelEditAuxAccount",a),v.metaAction.focus(a.path),v.extendAction.gridAction.cellAutoFocus(),e.next=26;break;case 13:if("endEditAuxAccount"!==t){e.next=25;break}if(n=a.path.split(",")[1],r=v.metaAction.gf("data.form.details"),r.get(n).get("accountingSubject"),c=v.metaAction.gf("data.other.editStatus"),i=void 0,c!=S.ADD_STATUS&&c!=S.EDIT_STATUS){e.next=21;break}return e.next=18,v.getAccountBalance(a.path,void 0,a);case 18:i=e.sent,a.balance=i,a.initBalance=i;case 21:v.injections.reduce("endEditAuxAccount",a,i),v.extendAction.gridAction.cellAutoFocus(),e.next=26;break;case 25:v.injections.reduce("onEvent",t,a);case 26:case"end":return e.stop()}},e,v)})),function(e,t){return r.apply(this,arguments)}),this.translateTemplate=function(e){for(var t=(0,D.List)(),a=0;a<e.length;a++)t=t.push({id:e[a].docTemplateId,code:e[a].docTemplateCode,name:e[a].docTemplateName+" [模板]",type:"template"});return t.toJS()},this.filterOption=function(e,t){if(t&&t.props&&t.props.value){var a=v.metaAction.gf("data.other.accountingSubjects").find(function(e){return e.get("id")==t.props.value});if(a.get("code")&&0==a.get("code").indexOf(e)||a.get("gradeName")&&-1!=a.get("gradeName").indexOf(e)||a.get("codeAndName")&&0==a.get("codeAndName").indexOf(e)||a.get("helpCode")&&-1!=a.get("helpCode").indexOf(e.toUpperCase())||a.get("helpCodeFull")&&-1!=a.get("helpCodeFull").indexOf(e)){var n=document.getElementsByClassName("ant-select-dropdown-menu");return 0<n.length&&0<n[0].scrollTop&&(n[0].scrollTop=0),!0}return!1}return!0},this.filterOptionSummary=function(e,t){return!(t&&t.props&&t.props.children)||0<=t.props.children.toLowerCase().indexOf(e.toLowerCase())},this.clearGridFocus=function(){v.metaAction.sf("data.other.focusFieldPath",void 0)},this.certificateManagement=function(){v.component.props.setPortalContent&&v.component.props.setPortalContent("凭证管理","app-proof-of-list")},this.getAudited=function(){return v.metaAction.gf("data.form.certificateStatus")==E.consts.VOUCHERSTATUS_Approved},this.isRowOperation=function(){return v.metaAction.gf("data.form.certificateStatus")==S.STATUS_VOUCHER_NOT_AUDITED},this.audit=(0,p["default"])(b["default"].mark(function e(){var t,a,n,r,c;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.metaAction.gf("data.form.id"),a=v.metaAction.gf("data.form.ts"),n=v.metaAction.gf("data.form.certificateStatus"),t&&a){e.next=4;break}return v.metaAction.toast("success","请先保存凭证！"),e.abrupt("return");case 4:if(n!=S.STATUS_VOUCHER_NOT_AUDITED){e.next=11;break}return e.next=7,v.webapi.certificate.audit({docId:t,ts:a});case 7:(r=e.sent)&&(v.metaAction.toast("success","凭证审核成功！"),v.injections.reduce("changeAuditStatus",S.STATUS_VOUCHER_AUDITED,v.getCurrentUser(),r)),e.next=15;break;case 11:return e.next=13,v.webapi.certificate.antiAudit({docId:t,ts:a});case 13:(c=e.sent)&&(v.metaAction.toast("success","凭证反审核成功！"),v.injections.reduce("changeAuditStatus",S.STATUS_VOUCHER_NOT_AUDITED,v.getCurrentUser(),c));case 15:case"end":return e.stop()}},e,v)})),this.commonMenuClick=function(e){switch(e.key){case"useCommon":v.uesCommon();break;case"saveCommon":v.saveCommon()}},this.uesCommon=function(){v.checkEditStatusBeforeLoadNewVoucher((0,p["default"])(b["default"].mark(function e(){var t,a;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.metaAction.modal("show",{title:"凭证模版",width:880,height:425,okText:"使用凭证模版",bodyStyle:{padding:"10px 50px"},children:v.metaAction.loadApp("ttk-voucher-app-document-common",{store:v.component.props.store,columnCode:"common"})});case 2:if(!(t=e.sent)){e.next=12;break}return e.next=6,v.webapi.commonDoc.findById({docTemplateId:t.docTemplateId});case 6:return a=e.sent,e.next=9,v.getMultiAccountBalance(a.entrys);case 9:a.entrys=e.sent,v.editCloseTips(!0),v.injections.reduce("applyCertificateTemplate",(0,D.fromJS)(a),S.ADD_STATUS);case 12:case"end":return e.stop()}},e,v)})))},this.editCloseTips=function(e){v.component.props.editing&&v.component.props.editing(v.component.props.appName,e)},this.saveCommon=(0,p["default"])(b["default"].mark(function e(){return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v.canSaveAsTemplate()){e.next=3;break}return v.metaAction.toast("warning","没有填写科目的凭证不能存为模板！"),e.abrupt("return");case 3:return e.next=5,v.metaAction.modal("show",{title:"存为凭证模版",width:340,children:v.metaAction.loadApp("ttk-voucher-app-document-common-add",{store:v.component.props.store,columnCode:"common",initData:{certificateData:v.metaAction.gf("data.form")}})});case 5:e.sent;case 6:case"end":return e.stop()}},e,v)})),this.canSaveAsTemplate=function(){var e=v.metaAction.gf("data.form.details"),t=!0,a=!1,n=void 0;try{for(var r,c=(0,C["default"])(e);!(t=(r=c.next()).done);t=!0){var i=r.value;if(v.convertVoucherItemForServer(i))return!0}}catch(e){a=!0,n=e}finally{try{!t&&c["return"]&&c["return"]()}finally{if(a)throw n}}return!1},this.getAccountBalance=(c=(0,p["default"])(b["default"].mark(function e(t,a,n){var r,c,i,o,u,d,s;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS){e.next=12;break}if(c=t.split(",")[1],i=v.metaAction.gf("data.form.details").get(c).get("accountingSubject"),o={},u=void 0,n?(u=n.data.get("auxAccountSubjects"),o.accountId=i.get("id")):o.accountId=a.get("id"),u)for(o.departmentId=u.get("department")?u.get("department").get("id"):void 0,o.personId=u.get("person")?u.get("person").get("id"):void 0,o.customerId=u.get("customer")?u.get("customer").get("id"):void 0,o.supplierId=u.get("supplier")?u.get("supplier").get("id"):void 0,o.inventoryId=u.get("inventory")?u.get("inventory").get("id"):void 0,o.projectId=u.get("project")?u.get("project").get("id"):void 0,d=1;d<=10;d++)o["exCalc"+d]=u.get("exCalc"+d)?u.get("exCalc"+d).get("id"):void 0;return e.next=8,v.webapi.certificate.getAccountBalance(o);case 8:null!=(s=e.sent)&&(r=s),e.next=13;break;case 12:r=0;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}},e,v)})),function(e,t,a){return c.apply(this,arguments)}),this.getMultiAccountBalance=(i=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0,v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS){e.next=10;break}for(a=[],r=n=void 0,c=0;c<t.length;c++){for(r=t[c],(n={}).accountId=r.accountId,n.departmentId=r.departmentId?r.departmentId:void 0,n.personId=r.personId?r.personId:void 0,n.customerId=r.customerIdcustomerId?r.customerId:void 0,n.supplierId=r.supplierId?r.supplierId:void 0,n.inventoryId=r.inventoryId?r.inventoryId:void 0,n.projectId=r.projectId?r.projectId:void 0,i=1;i<=10;i++)n["exCalc"+i]=r["exCalc"+i]?r["exCalc"+i]:void 0;a.push(n)}return e.next=6,v.webapi.certificate.getAccountsBalance(a);case 6:if(null!=(o=e.sent))for(c=0;c<t.length;c++)t[c].balance=o[c].balance;e.next=11;break;case 10:case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e,v)})),function(e){return i.apply(this,arguments)}),this.print=(0,p["default"])(b["default"].mark(function e(){var t,a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=v,e.next=3,v.webapi.certificate.getPrintConfig();case 3:a=e.sent,n=a.height,r=a.maxLineNum,c=a.printAuxAccCalc,i=a.type,o=a.width,v.metaAction.modal("show",{title:"打印",width:400,footer:null,iconType:null,okText:"打印",className:"print-modal-container",children:A["default"].createElement(I.PrintOption,{height:n,maxLineNum:r,printAuxAccCalc:c,type:i,width:o,callBack:t.submitPrintOption})});case 10:case"end":return e.stop()}},e,v)})),this.submitPrintOption=(o=(0,p["default"])(b["default"].mark(function e(t,a){var n,r;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.metaAction.gf("data.form.id"),r={type:parseInt(t.state.value),printAuxAccCalc:t.state.printAccountChecked,docIdsStr:""+n},"0"==t.state.value?(0,h["default"])(r,{maxLineNum:t.state.pageSize}):"2"==t.state.value&&(0,h["default"])(r,{height:t.state.height,width:t.state.width}),e.next=5,v.webapi.certificate.print(r);case 5:e.sent;case 6:case"end":return e.stop()}},e,v)})),function(e,t){return o.apply(this,arguments)}),this.save=(u=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=v.metaAction.gf("data.form").toJS(),n=v.checkVoucherDataBeforeSave(a),r={textAlign:"left",fontSize:"14px",display:"inline-block",verticalAlign:"top"},!(0<n.length)){e.next=5;break}return v.metaAction.toast("warning",A["default"].createElement("div",{style:r},n.map(function(e,t){return A["default"].createElement("p",{style:{marginBottom:"0"}},t+1+"."+e)}))),e.abrupt("return");case 5:if(c=v.getCertificateData(),v.injections.reduce("showBtnState",{path:"data.other.btnStatus",value:!0}),v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS&&c.docId){e.next=14;break}return e.next=10,v.webapi.certificate.create(c);case 10:(i=e.sent)&&(v.metaAction.toast("success","凭证保存成功"),v.injections.reduce("loadCertificate",(0,D.fromJS)(i),S.VIEW_STATUS),t&&"function"==typeof t&&t(),v.editCloseTips(!1)),e.next=18;break;case 14:return e.next=16,v.webapi.certificate.update(c);case 16:(o=e.sent)&&(v.metaAction.toast("success","凭证更新成功"),v.injections.reduce("loadCertificate",(0,D.fromJS)(o),S.VIEW_STATUS),t&&"function"==typeof t&&t(),v.editCloseTips(!1));case 18:v.injections.reduce("showBtnState",{path:"data.other.btnStatus",value:!1});case 19:case"end":return e.stop()}},e,v)})),function(e){return u.apply(this,arguments)}),this.saveAndNew=(0,p["default"])(b["default"].mark(function e(){var t,a,n,r,c,i,o,u,d,s,l,f,m,g;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.metaAction.gf("data.form").toJS(),a=v.checkVoucherDataBeforeSave(t),n={textAlign:"left",fontSize:"14px",display:"inline-block",verticalAlign:"top"},!(0<a.length)){e.next=5;break}return v.metaAction.toast("warning",A["default"].createElement("div",{style:n},a.map(function(e,t){return A["default"].createElement("p",{style:{marginBottom:"0"}},t+1+"."+e)}))),e.abrupt("return");case 5:if(r=v.getCertificateData(),v.injections.reduce("showBtnState",{path:"data.other.btnStatus",value:!0}),v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS&&r.docId){e.next=21;break}return e.next=10,v.webapi.certificate.create(r);case 10:if(!e.sent){e.next=19;break}return v.metaAction.toast("success","凭证保存成功"),c=(0,x["default"])(r.voucherDate),i=c.year(),o=c.month()+1,u={year:i,period:o,isReturnValue:!0},e.next=16,v.webapi.certificate.init(u);case 16:d=e.sent,v.editCloseTips(!1),0==d.result&&d.error&&"70002"==d.error.code?(v.metaAction.toast("error",d.error.message),v.injections.reduce("clearAndNewCertificate",{code:d.docCode,voucherDate:r.voucherDate})):(v.injections.reduce("clearAndNewCertificate",{code:d.docCode,voucherDate:r.voucherDate}),v.extendAction.gridAction.cellAutoFocus());case 19:e.next=32;break;case 21:return e.next=23,v.webapi.certificate.update(r);case 23:if(!e.sent){e.next=32;break}return v.metaAction.toast("success","凭证更新成功"),s=(0,x["default"])(r.voucherDate),l=s.year(),f=s.month()+1,m={year:l,period:f,isReturnValue:!0},e.next=29,v.webapi.certificate.init(m);case 29:g=e.sent,v.editCloseTips(!1),0==g.result&&g.error&&"70002"==g.error.code?(v.metaAction.toast("error",g.error.message),v.injections.reduce("clearAndNewCertificate",{code:g.docCode,voucherDate:r.voucherDate})):(v.injections.reduce("clearAndNewCertificate",{code:g.docCode,voucherDate:r.voucherDate}),v.extendAction.gridAction.cellAutoFocus());case 32:v.injections.reduce("showBtnState",{path:"data.other.btnStatus",value:!1});case 33:case"end":return e.stop()}},e,v)})),this.getCertificateData=function(){var e={},t=v.metaAction.gf("data.form");e.docType=t.get("docType"),e.docCode=t.get("code"),e.enclosures=v.getEnclosures(t.get("attachmentFiles").toJS());var a=(0,x["default"])(t.get("date"));e.voucherDate=a.format("YYYY-MM-DD"),e.year=a.year(),e.period=a.month()+1,e.attachedNum=t.get("attachCount"),e.isModifiedDocCode=e.docCode!=v.metaAction.gf("data.form.initVoucherCode"),e.isInsert=v.metaAction.gf("data.other.isInsert"),e.docCode=e.docCode.padStart(4,"0");var n=t.get("id");n&&(e.docId=n,e.ts=t.get("ts"));var r=[],c=t.get("details"),i=!0,o=!1,u=void 0;try{for(var d,s=(0,C["default"])(c);!(i=(d=s.next()).done);i=!0){var l=d.value,f=v.convertVoucherItemForServer(l,!0);f&&r.push(f)}}catch(e){o=!0,u=e}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw u}}var m=v.metaAction.gf("data.other.deletedCertificateItems");if(m&&0<m.size){var g=!0,h=!1,p=void 0;try{for(var A,S=(0,C["default"])(m);!(g=(A=S.next()).done);g=!0){var y=A.value;r.push({id:y.get("id"),rowStatus:3,ts:y.get("ts")})}}catch(e){h=!0,p=e}finally{try{!g&&S["return"]&&S["return"]()}finally{if(h)throw p}}}return e.entrys=r,e},this.getEnclosures=function(e){var t=[],a=e||[];return a&&0<a.length&&a.map(function(e){return t.push({id:e.id,file:{id:e.fileId,type:e.type,alt:e.alt,name:e.name,ts:e.ts,accessUrl:e.accessUrl},operateStatus:1}),t}),v.injections.reduce("upload",t,void 0,a?a.length:void 0),t},this.convertVoucherItemForServer=function(e,t){if(e&&e.get("accountingSubject")&&(e.get("debitAmount")||e.get("creditAmount"))&&(!e.get("accountingSubject").get("isCalcQuantity")&&!e.get("accountingSubject").get("isCalcMulti")||e.get("quantityAndForeignCurrency"))&&(!e.get("accountingSubject").get("isCalc")||e.get("accountingSubject").get("auxAccountSubjects"))){var a={id:e.get("id")?e.get("id"):null,summary:e.get("summary"),accountId:e.get("accountingSubject").get("id"),origAmountDr:e.get("debitAmount"),amountDr:e.get("debitAmount"),origAmountCr:e.get("creditAmount"),amountCr:e.get("creditAmount"),ts:e.get("ts")?e.get("ts"):null,inPutTaxDeductId:e.get("inPutTaxDeductId")?e.get("inPutTaxDeductId"):null};if(t&&(e.get("id")?(a.id=e.get("id"),a.rowStatus=2,a.ts=e.get("ts")):a.rowStatus=1),e.get("accountingSubject").get("isCalcQuantity")?(a.quantity=e.get("quantityAndForeignCurrency").get("quantity"),a.price=e.get("quantityAndForeignCurrency").get("price"),a.unitId=e.get("accountingSubject").get("unitId"),a.exchangeRate=1):(a.quantity=null,a.price=null,a.unitId=null,a.exchangeRate=null),e.get("accountingSubject").get("isCalcMulti")?(a.currencyId=e.get("quantityAndForeignCurrency").get("currency")?e.get("quantityAndForeignCurrency").get("currency").get("id"):"",a.exchangeRate=e.get("quantityAndForeignCurrency").get("exchangeRate"),a.amountDr?a.origAmountDr=e.get("quantityAndForeignCurrency").get("origAmount")||0:a.origAmountCr=e.get("quantityAndForeignCurrency").get("origAmount")||0):(a.currencyId=null,a.exchangeRate=1,a.origAmountDr=null,a.origAmountCr=null),e.get("accountingSubject").get("isCalc")){var n=e.get("accountingSubject").get("auxAccountSubjects");e.get("accountingSubject").get("isCalcDepartment")?a.departmentId=n.get("department").get("id"):a.departmentId=null,e.get("accountingSubject").get("isCalcPerson")?a.personId=n.get("person").get("id"):a.personId=null,e.get("accountingSubject").get("isCalcCustomer")?a.customerId=n.get("customer").get("id"):a.customerId=null,e.get("accountingSubject").get("isCalcSupplier")?a.supplierId=n.get("supplier").get("id"):a.supplierId=null,e.get("accountingSubject").get("isCalcInventory")?a.inventoryId=n.get("inventory").get("id"):a.inventoryId=null,e.get("accountingSubject").get("isCalcProject")?a.projectId=n.get("project").get("id"):a.projectId=null;for(var r=1;r<=10;r++)e.get("accountingSubject").get("isExCalc"+r)?a["exCalc"+r]=n.get("exCalc"+r).get("id"):a["exCalc"+r]=null}else{a.customerId=null,a.departmentId=null,a.personId=null,a.inventoryId=null,a.supplierId=null,a.projectId=null;for(r=1;r<=10;r++)a["exCalc"+r]=null}return a}},this.onSummarySelect=function(r,c,e,i){return t=(0,p["default"])(b["default"].mark(function e(t){var a,n;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=i.find(function(e){return e.name==t}))){e.next=18;break}if("template"!=a.type){e.next=13;break}return t&&(t=t.replace(" [模板]","")),e.next=6,v.webapi.commonDoc.findById({docTemplateName:t});case 6:return n=e.sent,e.next=9,v.getMultiAccountBalance(n.entrys);case 9:n.entrys=e.sent,v.injections.reduce("applySummaryTemplate",(0,D.fromJS)(n),c),e.next=16;break;case 13:v.metaAction.sf("data.form.details."+c+".summary",a.name),v.injections.reduce("onEvent","onEndEdit",{path:r,data:(0,D.fromJS)(a),isChanged:!0}),v.extendAction.gridAction.cellAutoFocus();case 16:e.next=21;break;case 18:v.metaAction.sf("data.form.details."+c+".summary",t),v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS&&v.metaAction.sf("data.other.editStatus",S.EDIT_STATUS);case 21:v.editCloseTips(!0);case 22:case"end":return e.stop()}},e,v)})),function(e){return t.apply(this,arguments)};var t},this.onSummaryChange=function(a){return t=(0,p["default"])(b["default"].mark(function e(t){return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:v.metaAction.sf("data.form.details."+a+".summary",t),v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS&&v.metaAction.sf("data.other.editStatus",S.EDIT_STATUS);case 3:case"end":return e.stop()}},e,v)})),function(e){return t.apply(this,arguments)};var t},this.onFieldChange=(d=(0,p["default"])(b["default"].mark(function e(t,a,n){var r,c,i;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1==t.indexOf("code")&&v.metaAction.gf("data.other.editStatus")==S.VIEW_STATUS&&v.metaAction.gf("data.form.certificateStatus")!=S.STATUS_VOUCHER_AUDITED&&a!=n?v.injections.reduce("changeStatus",S.EDIT_STATUS,S.STATUS_VOUCHER_NOT_AUDITED):-1<t.indexOf("code")&&v.metaAction.gf("data.other.editStatus")==S.VIEW_STATUS&&v.metaAction.gf("data.form.certificateStatus")!=S.STATUS_VOUCHER_AUDITED&&v.injections.reduce("changeStatus",S.EDIT_STATUS,S.STATUS_VOUCHER_NOT_AUDITED),!(-1<t.indexOf("date"))){e.next=10;break}if(r=(0,x["default"])(a),c=(0,x["default"])(n),r.year()==c.year()&&r.month()==c.month()){e.next=8;break}return e.next=6,v.webapi.certificate.getNewDocCode({year:c.year(),period:c.month()+1});case 6:i=e.sent,v.injections.reduce("initVoucherCode",i.docCode);case 8:e.next=11;break;case 10:-1<t.indexOf("attachment")&&(isNaN(n)||parseInt(n)>S.MAX_ATTACH_COUNT?v.metaAction.toast("warning","附件数最大为"+S.MAX_ATTACH_COUNT):n!=a&&(v.metaAction.sf("data.form.attachCount",parseInt(n)),v.injections.reduce("changeStatus",S.EDIT_STATUS,S.STATUS_VOUCHER_NOT_AUDITED)));case 11:v.injections.reduce("onFieldChange",t,a,n);case 12:case"end":return e.stop()}},e,v)})),function(e,t,a){return d.apply(this,arguments)}),this.dateKeydown=function(e){13==e.keyCode&&(document.getElementsByClassName("ttk-voucher-app-document-form-header-attachment-number")[0].focus(),document.getElementsByClassName("ant-calendar-picker-input")[0].removeEventListener("keydown",v.dateKeydown,!1))},this.onPressEnter=function(e){"code"==e?(v.metaAction.sf("data.other.focusFieldPath","root.children.formHeader.children.date.children.date"),document.getElementsByClassName("ant-calendar-picker-input")[0].focus(),document.getElementsByClassName("ant-calendar-picker-input")[0].addEventListener("keydown",v.dateKeydown,!1)):"date"==e?v.metaAction.sf("data.other.focusFieldPath","root.children.formHeader.children.attachment.children.attachment"):"attachment"==e&&(v.metaAction.sf("data.other.focusFieldPath","root.children.details.columns.summary.cell.cell,0"),v.extendAction.gridAction.cellAutoFocus())},this.onSubjectSelect=function(o,u,d){return t=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=v.metaAction.gf("data.form.details"),n=a.get(u).get("accountingSubject"),r=v.metaAction.gf("data.other.editStatus"),c=d.find(function(e){return e.id==t}),i=void 0,!n||n.get("id")!=c.id){e.next=13;break}if(n.get("isCalc")||r!=S.ADD_STATUS&&r!=S.EDIT_STATUS){e.next=10;break}return e.next=7,v.getAccountBalance(o,(0,D.fromJS)(n));case 7:i=e.sent,n.balance=v.getPageBalance(n.code,u,i),n.initBalance=i;case 10:v.injections.reduce("onEvent","onEndEdit",{path:o,data:(0,D.fromJS)(n),isChanged:!1}),e.next=20;break;case 13:if(c.isCalc||r!=S.ADD_STATUS&&r!=S.EDIT_STATUS){e.next=19;break}return e.next=16,v.getAccountBalance(o,(0,D.fromJS)(c));case 16:i=e.sent,c.balance=v.getPageBalance(c.code,u,i),c.initBalance=i;case 19:v.injections.reduce("onEvent","onEndEdit",{path:o,data:(0,D.fromJS)(c),isChanged:!0});case 20:v.editCloseTips(!0),v.extendAction.gridAction.cellAutoFocus();case 22:case"end":return e.stop()}},e,v)})),function(e){return t.apply(this,arguments)};var t},this.getPageBalance=function(e,t,a){for(var n=v.metaAction.gf("data.form.details"),r=a,c=0;c<n.size;c++)c!=t&&n.get(c).get("accountingSubject")&&n.get(c).get("accountingSubject").get("code")==e&&(r=n.get(c).get("accountingSubject").get("balance"));return r},this.amountChange=function(n){return function(e,t){v.editCloseTips(!0);var a=v.metaAction.gf("data.other.editStatus");"0"!=e?v.injections.reduce("onFieldChange",n,t,e):t!=e&&(a!=S.EDIT_STATUS&&a!=S.VIEW_STATUS||v.injections.reduce("changeStatus",S.EDIT_STATUS,S.STATUS_VOUCHER_NOT_AUDITED))}},this.amountBlur=function(t){return function(){var e=v.metaAction.gf("data.other.originalFieldPath");v.injections.reduce("onEvent","onBlur",{path:e}),v.metaAction.sf("data.other.originalFieldPath",t)}},this.onShortcutKey=function(e){v.injections.reduce("onEvent","onShortcutKey",{path:e,keyEvent:event}),!event||" "!=event.key&&32!=event.keyCode||v.extendAction.gridAction.cellAutoFocus()},this.sum=function(e,a){return v.sumInternal(e,function(e,t){return e+parseFloat(t[a])})},this.getTotal=function(e){var t=v.sum(e,"debitAmount");return"合计："+R["default"].number.moneySmalltoBig(parseFloat(t.toFixed(2)))},this.addSubject=function(r){return(0,p["default"])(b["default"].mark(function e(){var t,a,n;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.metaAction.modal("show",{title:"新增科目",width:400,okText:"保存",children:v.metaAction.loadApp("ttk-voucher-app-document-subjects-add",{store:v.component.props.store,columnCode:"subjects",active:"certificate"})});case 2:if(!(t=e.sent)){e.next=10;break}return e.next=6,v.getSubjectList();case 6:a=e.sent,v.injections.reduce("setAccoutingSubject",r,a,t),n="root.children.details.columns.accountingSubject.cell.cell,"+r,v.onSubjectChange(n,r,a.glAccounts)(t.id);case 10:case"end":return e.stop()}},e,v)}))},this.getAuditText=function(){return v.metaAction.gf("data.form.certificateStatus")===S.STATUS_VOUCHER_AUDITED?"反审核":"审核"},this.cellStyle=function(e){if(v.metaAction.isFocus(e))return" editable-cell"},this.attachmentChange=(s=(0,p["default"])(b["default"].mark(function e(t){return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:v.injections.reduce("attachmentLoading",!0),v.upload({id:0xf3baf45f6d400,originalName:t.file.name,name:t.file.name,root:"ttk-dev",path:"ATTACHMENT/4281915938039808/",uploadUserId:0xf36613e59e800,type:1000010006,size:56054,suffix:t.file.type,md5:"opgfW8T6QWKfvizAeRjarA==",ts:"2018-03-27 16:47:37.0",accessUrl:"http://ttk-dev.oss-cn-beijing.aliyuncs.com/ATTACHMENT/4281915938039808/4281915936466944-4287748629779456-eae2fed153820be2d2e5af633154d4dd.jpeg?Expires=1522144057&OSSAccessKeyId=LTAIa9iudLuMqc12&Signature=LtEdUl+VBXSrG6H0zbSfwAubd2E=",uploadTime:"2018-03-27 16:47:37"},"2018-03-27 16:47:37.0");case 2:case"end":return e.stop()}},e,v)})),function(e){return s.apply(this,arguments)}),this.upload=(l=(0,p["default"])(b["default"].mark(function e(t,a){var n,r,c,i,o,u;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.metaAction.gf("data.form").toJS(),r=v.metaAction.gf("data.form.attachmentFiles").toJS()||[],[],r.push({accessUrl:t.accessUrl,ts:t.ts||"",type:t.type,name:t.originalName,fileId:t.id}),!(20<r.length)){e.next=8;break}return v.metaAction.toast("warning","最多上传20个附件"),v.injections.reduce("attachmentLoading",!1),e.abrupt("return");case 8:if(!n.id){e.next=19;break}return(c=[]).push({fileId:t.id,operateStatus:1,file:{id:t.id,type:t.type}}),i={docId:n.id,enclosures:c},e.next=14,v.webapi.certificate.updateEnclosure(i);case 14:o=e.sent,r=[],o&&((u=o.enclosures).map(function(e){r.push({id:e.id,accessUrl:e.file.accessUrl,ts:e.ts||"",type:e.file.type,name:e.file.originalName,fileId:e.file.id})}),v.injections.reduce("upload",u,o.ts,r.length)),e.next=20;break;case 19:v.injections.reduce("upload",r,a,r.length);case 20:v.injections.reduce("attachmentLoading",!1);case 21:case"end":return e.stop()}},e,v)})),function(e,t){return l.apply(this,arguments)}),this.getAccessToken=function(){return{token:T.fetch.getAccessToken()}},this.download=function(e){var t=document.createElement("a");t.download=e.accessUrl,t.href=e.accessUrl,t.click()},this.moreMenuClick=function(e){switch(e.key){case"del":v.del();break;case"insert":v.insert()}},this.delFile=(f=(0,p["default"])(b["default"].mark(function e(a){var n,t,r;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return v.injections.reduce("attachmentVisible",!0),e.next=3,v.metaAction.modal("confirm",{title:"删除",content:"确认删除?"});case 3:if(!e.sent){e.next=16;break}if(n=v.metaAction.gf("data.form").toJS(),t={docId:n.id,enclosures:[{id:a.id,operateStatus:3,ts:a.ts,file:{id:a.fileId,type:a.type}}]},n.attachmentFiles.map(function(e,t){return e.fileId==a.fileId&&n.attachmentFiles.splice(t,1),n.attachmentFiles}),!n.id){e.next=15;break}return e.next=11,v.webapi.certificate.updateEnclosure(t);case 11:(r=e.sent)&&(console.log("data.attachedNum:"+r.attachedNum),v.injections.reduce("upload",n.attachmentFiles,r.ts,r.attachedNum),v.metaAction.toast("success","删除成功！")),e.next=16;break;case 15:v.injections.reduce("upload",n.attachmentFiles,a.ts,n.attachmentFiles.length);case 16:case"end":return e.stop()}},e,v)})),function(e){return f.apply(this,arguments)}),this.del=(0,p["default"])(b["default"].mark(function e(){var t,a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.metaAction.gf("data.form.id"),a=v.metaAction.gf("data.form.ts"),n=v.metaAction.gf("data.form.voucherSource"),r=v.metaAction.gf("data.form.sourceVoucherTypeId"),i=c=void 0,n?(c=143==r?"单据："+n+"是TTK会计填写的凭证，如果驳回，会将对应的流水账同时删除，请确认要驳回吗？":"单据："+n+"将被驳回到业务，当前凭证会被删除。请确认要驳回吗？",i="驳回"):(c="确定删除该凭证?",i="删除"),t&&a){e.next=5;break}return v.metaAction.toast("info","请先保存凭证!"),e.abrupt("return");case 5:return v.injections.reduce("showBtnState",{path:"data.other.btnStatus",value:!0}),e.next=8,v.metaAction.modal("confirm",{title:i+"凭证",content:c});case 8:if(!e.sent){e.next=15;break}return e.next=12,v.webapi.certificate.del({docId:t,ts:a});case 12:o=e.sent,v.metaAction.toast("success","删除凭证成功"),o?v.injections.reduce("loadCertificate",(0,D.fromJS)(o),S.VIEW_STATUS):v.newCertificate(void 0);case 15:v.injections.reduce("showBtnState",{path:"data.other.btnStatus",value:!1});case 16:case"end":return e.stop()}},e,v)})),this.insert=(0,p["default"])(b["default"].mark(function e(){var t,a,n;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.metaAction.gf("data.form.code"),a=v.metaAction.gf("data.form.date"),"9999"!=t){e.next=4;break}return v.metaAction.toast("error","凭证号达到9999，不能再增加凭证！"),e.abrupt("return");case 4:n=v.getEnabledYearMonth(),v.checkEditStatusBeforeLoadNewVoucher(function(){v.injections.reduce("clearAndNewCertificate",{code:t,voucherDate:a,isInsert:!0},void 0,void 0,n)}),v.extendAction.gridAction.cellAutoFocus();case 7:case"end":return e.stop()}},e,v)})),this.newCertificate=(m=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,x["default"])(v.metaAction.gf("data.form.date")),n=a.year(),r=a.month()+1,c={year:n,period:r,isReturnValue:!0},i=v.getEnabledYearMonth(),e.next=3,v.webapi.certificate.init(c);case 3:0==(o=e.sent).result&&o.error&&"70002"==o.error.code?(v.metaAction.toast("error",o.error.message),v.injections.reduce("clearAndNewCertificate",{code:o.docCode,voucherDate:o.voucherDate},t&&t.glAccounts?t:void 0,void 0,i)):(v.injections.reduce("clearAndNewCertificate",{code:o.docCode,voucherDate:o.voucherDate},t&&t.glAccounts?t:void 0,void 0,i),v.extendAction.gridAction.cellAutoFocus());case 5:case"end":return e.stop()}},e,v)})),function(e){return m.apply(this,arguments)}),this.loadNextCertificate=function(){v.checkEditStatusBeforeLoadNewVoucher((0,p["default"])(b["default"].mark(function e(){var t,a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.metaAction.gf("data.form.code"),a=(0,x["default"])(v.metaAction.gf("data.form.date")),n=a.year(),r=a.month()+1,c=v.metaAction.gf("data.other.editStatus"),i=void 0,i=c==S.ADD_STATUS,e.next=4,v.webapi.certificate.next({docCode:t,year:n,period:r,isReturnValue:!0,isCreate:i});case 4:0==(o=e.sent).result&&o.error.code==S.ALREADY_LAST_CERTIFICATE?(v.metaAction.toast("warning",o.error.message),v.injections.reduce("setNextOrPrivDis","nextBtn")):v.injections.reduce("loadCertificate",(0,D.fromJS)(o),S.VIEW_STATUS);case 6:case"end":return e.stop()}},e,v)})))},this.loadPrevCertificate=function(){v.checkEditStatusBeforeLoadNewVoucher((0,p["default"])(b["default"].mark(function e(){var t,a,n,r,c,i,o;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.metaAction.gf("data.form.code"),a=(0,x["default"])(v.metaAction.gf("data.form.date")),n=a.year(),r=a.month()+1,c=v.metaAction.gf("data.other.editStatus"),i=void 0,i=c==S.ADD_STATUS,e.next=4,v.webapi.certificate.prev({docCode:t,year:n,period:r,isReturnValue:!0,isCreate:i});case 4:0==(o=e.sent).result&&o.error.code==S.ALREADY_FIRST_CERTIFICATE?(v.metaAction.toast("warning",o.error.message),v.injections.reduce("setNextOrPrivDis","prevBtn")):v.injections.reduce("loadCertificate",(0,D.fromJS)(o),S.VIEW_STATUS);case 6:case"end":return e.stop()}},e,v)})))},this.checkEditStatusBeforeLoadNewVoucher=(g=(0,p["default"])(b["default"].mark(function e(t){var a,n,r,c,i,o,u,d,s,l,f,m;return b["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!1,(n=v.metaAction.gf("data.other.editStatus"))!=S.EDIT_STATUS){e.next=5;break}a=!0,e.next=36;break;case 5:if(n!=S.ADD_STATUS){e.next=36;break}if(!(r=v.metaAction.gf("data.form.details"))){e.next=36;break}c=(0,D.Map)(S.blankVoucherItem),o=!(i=!0),u=void 0,e.prev=12,d=(0,C["default"])(r);case 14:if(i=(s=d.next()).done){e.next=22;break}if(!(l=s.value)||(0,D.is)(l,c)){e.next=19;break}return a=!0,e.abrupt("break",22);case 19:i=!0,e.next=14;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e["catch"](12),o=!0,u=e.t0;case 28:e.prev=28,e.prev=29,!i&&d["return"]&&d["return"]();case 31:if(e.prev=31,!o){e.next=34;break}throw u;case 34:return e.finish(31);case 35:return e.finish(28);case 36:if(!a){e.next=44;break}return f=function(){t()},m=function(){v.save(function(){t()})},e.next=40,v.metaAction.modal("confirm",{title:"保存",content:"您的凭证尚未保存，是否要保存?"});case 40:e.sent?m():f(),e.next=45;break;case 44:t();case 45:case"end":return e.stop()}},e,v,[[12,24,28,36],[29,,31,35]])})),function(e){return g.apply(this,arguments)}),this.isCommonTemplateDisabled=function(){return v.metaAction.gf("data.other.editStatus")!=S.ADD_STATUS},this.renderFormHeaderTitleShow=function(e){if(e)return"string"==typeof e&&(e=(0,x["default"])(new Date(e))),A["default"].createElement("span",null,e.year()+"年第"+(e.month()+1)+"期")},this.componentWillUnmount=function(){null!=sessionStorage.getItem("auxAccountSubjects")&&sessionStorage.removeItem("auxAccountSubjects"),null!=sessionStorage.getItem("isClickCancelBtn")&&sessionStorage.removeItem("isClickCancelBtn");var e=window;e.removeEventListener?(document.getElementById("app").removeEventListener("click",v.windowClick,!1),document.body.removeEventListener("keydown",v.bodyKeydownEvent,!1)):e.detachEvent&&(document.getElementById("app").detachEvent("onclick",v.windowClick),document.body.detachEvent("onkeydown",v.bodyKeydownEvent))}},n);e.exports=t["default"]},1068:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,c=g(a(19)),m=g(a(1160)),i=g(a(0)),C=g(a(20)),p=g(a(16)),o=g(a(7)),u=g(a(9));t["default"]=function(e){var t=new d.reducer(e),a=l["default"].reducerCreator((0,i["default"])({},e,{metaReducer:t})),n=new h((0,i["default"])({},e,{metaReducer:t,extendReducer:a}));return(0,i["default"])({},t,a.gridReducer,n)};var A=a(14),d=a(34),s=g(a(230)),x=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}}(a(51)),l=(g(a(13)),g(a(1109))),f=g(a(1));function g(e){return e&&e.__esModule?e:{"default":e}}var h=(n=function(){function t(e){(0,o["default"])(this,t),r.call(this),this.metaReducer=e.metaReducer,this.extendReducer=e.extendReducer,this.config=s["default"].current}return(0,u["default"])(t,[{key:"toFixedLocal",value:function(e,t){var a=e;return e&&-1<e.toString().indexOf(".")&&e.toString().split(".")[1].length>t&&(a=isNaN(e)?0:parseFloat(Math.round(e*Math.pow(10,t))/Math.pow(10,t))),a}},{key:"isEqualAuxItemFile",value:function(e,t,a){var n=!0;return t.get(e)&&(!a.get(e)||a.get(e)&&t.get(e).get("id")!=a.get(e).get("id"))&&(n=!1),n}}]),t}(),r=function(){var b=this;this.init=function(e,t){return e=b.metaReducer.init(e,x.getInitState())},this.attachmentLoading=function(e,t){return e=b.metaReducer.sf(e,"data.form.attachmentLoading",t)},this.attachmentVisible=function(e,t){return e=b.metaReducer.sf(e,"data.form.attachmentVisible",t)},this.initNewCertificate=function(e,t,a,n,r){return t&&(e=b.initVoucherCode(e,t.docCode),e=b.metaReducer.sf(e,"data.form.date",t.voucherDate)),e=b.metaReducer.sf(e,"data.other.accountingSubjects",(0,A.fromJS)(a.glAccounts)),e=b.metaReducer.sf(e,"data.other.accountingSubjectsAll",(0,A.fromJS)(a.glAccountsAll)),e=b.metaReducer.sf(e,"data.other.calcDict",(0,A.Map)(a.calcDict)),e=b.metaReducer.sf(e,"data.other.currencyDS",(0,A.fromJS)(r)),e=b.metaReducer.sf(e,"data.other.disabledDate",n),e=b.metaReducer.sf(e,"data.form.attachmentStatus",0),t&&(e=b.metaReducer.sf(e,"data.other.focusFieldPath","root.children.details.columns.summary.cell.cell,0")),e},this.initLoadCertificate=function(e,t,a,n,r){return e=b.metaReducer.sf(e,"data.other.accountingSubjects",(0,A.fromJS)(n.glAccounts)),e=b.metaReducer.sf(e,"data.other.accountingSubjectsAll",(0,A.fromJS)(n.glAccountsAll)),e=b.metaReducer.sf(e,"data.other.calcDict",(0,A.Map)(n.calcDict)),e=b.metaReducer.sf(e,"data.other.currencyDS",(0,A.fromJS)(r)),e=b.loadCertificate(e,t),e=t.get("voucherState")==x.STATUS_VOUCHER_AUDITED?b.changeStatus(e,x.VIEW_STATUS,x.STATUS_VOUCHER_AUDITED):b.changeStatus(e,x.VIEW_STATUS,x.STATUS_VOUCHER_NOT_AUDITED),a&&(e=b.metaReducer.sf(e,"data.other.disabledDate",a)),e},this.setrowsCount=function(e,t,a){return e=b.metaReducer.sf(e,"data.form.details",(0,A.fromJS)(t)),e=b.metaReducer.sf(e,"data.other.defaultLength",a)},this.loadCertificate=function(e,t,a){var n=(0,A.Map)({id:t.get("docId"),code:t.get("docCode"),date:t.get("voucherDate"),docType:t.get("docType"),attachCount:t.get("attachedNum"),creatorId:t.get("creatorId"),creator:t.get("creator"),auditorId:t.get("auditorId"),auditor:t.get("auditor"),certificateStatus:t.get("voucherState"),certificateStatusName:t.get("voucherStateName"),ts:t.get("ts"),voucherSource:t.get("sourceVoucherCode")||"",sourceVoucherId:t.get("sourceVoucherId")||"",sourceVoucherTypeId:t.get("sourceVoucherTypeId")||"",attachmentFiles:b.convertToAttachmentFiles(t.get("enclosures").toJS()),isAttachCount:0==t.get("attachedNum")});e=b.metaReducer.sf(e,"data.other.isShow",!1),e=b.metaReducer.sf(e,"data.other.isDisplayQuantityColumn",!1);var r=(0,A.List)(),c=!1,i="",o=!0,u=!1,d=void 0;try{for(var s,l=(0,p["default"])(t.get("entrys"));!(o=(s=l.next()).done);o=!0){var f=s.value,m=b.getVoucherItemFromEntry(e,f);r=r.push(m),(m.get("accountingSubject").get("isCalcMulti")||m.get("accountingSubject").get("isCalcQuantity"))&&(c=!0,i=b.getQuantityAndCurrentTitle(i,m.get("accountingSubject")))}}catch(e){u=!0,d=e}finally{try{!o&&l["return"]&&l["return"]()}finally{if(u)throw d}}e=c?b.enableQuantityAndForeignCurrency(e,i):b.disableQuantityAndForeignCurrency(e);var g=b.metaReducer.gf(e,"data.other.defaultLength")-r.size;if(0<g)for(var h=0;h<g;h++)r=r.push((0,A.fromJS)(x.blankVoucherItem));return r=b.updateBalanceShowable(r,a),n=n.set("details",r),e=b.metaReducer.sf(e,"data.form",n),e=b.metaReducer.sf(e,"data.form.adjunctInfo.album",(0,A.fromJS)(t.get("enclosures"))),e=b.metaReducer.sf(e,"data.form.adjunctInfo.adjunctSize",t.get("enclosures")?t.get("enclosures").size:0),e=b.clearGridFocus(e),e=b.clearDeleteddetails(e),e=b.metaReducer.sf(e,"data.other.detailsScrollToRow",0),b.changeStatus(e,a,n.get("certificateStatus"))},this.clearDeleteddetails=function(e){return b.metaReducer.sf(e,"data.other.deletedCertificateItems",void 0)},this.clearAndNewCertificate=function(e,t,a,n,r){var c=a&&a.glAccounts?(0,A.fromJS)(a.glAccounts):b.metaReducer.gf(e,"data.other.accountingSubjects"),i=a&&a.glAccountsAll?(0,A.fromJS)(a.glAccountsAll):b.metaReducer.gf(e,"data.other.accountingSubjectsAll"),o=b.metaReducer.gf(e,"data.other.currencyDS"),u=b.metaReducer.gf(e,"data.other.calcDict"),d=b.metaReducer.gf(e,"data.other.defaultLength"),s=b.metaReducer.gf(e,"data.form.date");return e=b.metaReducer.init(e,x.getInitState()),e=b.metaReducer.sf(e,"data.other.defaultLength",d),e=b.completeBlankRow(e,d),e=b.changeStatus(e,x.ADD_STATUS,x.STATUS_VOUCHER_NOT_AUDITED),e=b.metaReducer.sf(e,"data.other.currencyDS",null!=n?(0,A.fromJS)(n):o),e=b.initVoucherCode(e,t.code),e=null!=t.voucherDate?b.metaReducer.sf(e,"data.form.date",t.voucherDate):b.metaReducer.sf(e,"data.form.date",s),e=b.metaReducer.sf(e,"curCellAuxAccountSubjects",void 0),e=b.metaReducer.sf(e,"curCellCodeAndName",void 0),e=b.metaReducer.sf(e,"data.form.attachmentStatus",0),e=b.metaReducer.sf(e,"data.other.accountingSubjects",c),e=b.metaReducer.sf(e,"data.other.accountingSubjectsAll",i),e=b.metaReducer.sf(e,"data.other.calcDict",null!=a?(0,A.Map)(a.calcDict):u),e=b.metaReducer.sf(e,"data.other.isInsert",!!t.isInsert),e=b.metaReducer.sf(e,"data.other.disabledDate",r),t.code&&(e=b.metaReducer.sf(e,"data.other.focusFieldPath","root.children.details.columns.summary.cell.cell,0")),e},this.completeBlankRow=function(e,t){var a=b.metaReducer.gf(e,"data.form.details");if(a.size<t){for(var n=a.size;n<t;n++)a=a.push((0,A.Map)(x.blankVoucherItem));e=b.metaReducer.sf(e,"data.form.details",a)}return e},this.initVoucherCode=function(e,t){return e=b.metaReducer.sf(e,"data.form.initVoucherCode",t),b.metaReducer.sf(e,"data.form.code",t)},this.updateBalanceShowable=function(e,t){var a=(0,A.List)(),n=!0,r=!1,c=void 0;try{for(var i,o=(0,p["default"])(e);!(n=(i=o.next()).done);n=!0){var u=i.value,d=u.get("accountingSubject");d&&"object"==(void 0===d?"undefined":(0,C["default"])(d))&&(u=u.set("accountingSubject",d.set("showBalance",t==x.EDIT_STATUS||t==x.ADD_STATUS))),a=a.push(u)}}catch(e){r=!0,c=e}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw c}}return a},this.disableQuantityAndForeignCurrency=function(e){return e=b.metaReducer.sf(e,"data.other.quantityAndForeignCurrencyTitle",""),e=b.metaReducer.sf(e,"data.other.isDisplayQuantityColumn",!1),e=b.metaReducer.sf(e,"data.other.quantityAndForeignCurrencyWidth",0),e=b.metaReducer.sf(e,"data.other.summaryWidth",220)},this.getVoucherItemFromEntry=function(e,t){var a=t.get("accountDto")||b.getAccountById(e,t.get("accountId"));null==a&&(a=(0,A.fromJS)({}));for(var n={department:t.get("departmentId")?{id:t.get("departmentId"),name:t.get("departmentName")}:void 0,person:t.get("personId")?{id:t.get("personId"),name:t.get("personName")}:void 0,customer:t.get("customerId")?{id:t.get("customerId"),name:t.get("customerName")}:void 0,supplier:t.get("supplierId")?{id:t.get("supplierId"),name:t.get("supplierName")}:void 0,inventory:t.get("inventoryId")?{id:t.get("inventoryId"),name:t.get("inventoryName")}:void 0,project:t.get("projectId")?{id:t.get("projectId"),name:t.get("projectName")}:void 0},r=1;r<=10;r++)t.get("exCalc"+r)?n["exCalc"+r]={id:t.get("exCalc"+r),name:t.get("exCalc"+r+"Name")}:n["exCalc"+r]=void 0;return null!=t.get("balance")&&(a=(a=a.set("balance",b.getRuntimeBalance(e,a.get("code"),t.get("balance")))).set("initBalance",t.get("balance"))),(0,A.fromJS)({id:t.get("id"),summary:t.get("summary"),accountingSubject:(0,i["default"])({},a.toJS(),{auxAccountSubjects:n,auxAccountSubjectsPreSelected:n}),quantityAndForeignCurrency:{quantity:t.get("quantity"),price:t.get("price"),origAmount:null!=t.get("origAmountDr")?t.get("origAmountDr"):t.get("origAmountCr"),exchangeRate:t.get("exchangeRate")?t.get("exchangeRate"):a.get("exchangeRate"),amount:null!=t.get("amountDr")?t.get("amountDr"):t.get("amountCr"),currency:{id:t.get("currencyId")?t.get("currencyId"):a.get("currencyId"),name:t.get("currencyName")?t.get("currencyName"):a.get("currencyName"),exchangeRate:t.get("exchangeRate")?t.get("exchangeRate"):a.get("exchangeRate")},unitName:t.get("unitName"),isCalcQuantity:a.get("isCalcQuantity"),isCalcMulti:a.get("isCalcMulti")},debitAmount:t.get("amountDr")||0,creditAmount:t.get("amountCr")||0,ts:t.get("ts"),inPutTaxDeductId:t.get("inPutTaxDeductId"),accountList:t.get("accountList")})},this.getRuntimeBalance=function(e,t,a){var n=a,r=b.metaReducer.gf(e,"data.form.details").filter(function(e){return e.get("accountingSubject")&&e.get("accountingSubject").get("code")==t});return 0<r.size&&(n=r.get(0).get("accountingSubject").get("balance")),n},this.getAccountById=function(e,a){var t=b.metaReducer.gf(e,"data.other.accountingSubjectsAll"),n=(0,A.Map)();return t&&(n=t.find(function(e,t){return e.get("id")==a})),n},this.endEditAuxAccount=function(e,t){var a=t.path.split(",")[1],n=b.metaReducer.gf(e,"data.form.details"),r=(n.get(a),n.get(a).get("accountingSubject"));if(r){var c=r.get("auxAccountSubjectsPreSelected");if(!b.isEqualAuxAccountSubjects(t.data.get("auxAccountSubjects"),c))b.metaReducer.gf(e,"data.other.editStatus")!=x.ADD_STATUS&&(e=b.changeStatus(e,x.EDIT_STATUS,x.STATUS_VOUCHER_NOT_AUDITED))}return r=(r=(r=r.set("auxAccountSubjects",(0,A.fromJS)(t.data.get("auxAccountSubjects")))).set("auxAccountSubjectsPreSelected",(0,A.fromJS)(t.data.get("auxAccountSubjects")))).set("balance",t.balance),e=b.metaReducer.sf(e,"data.form.details."+a+".accountingSubject",r),1==b.metaReducer.gf(e,"root.children.details.columns.accountingSubject.isReadOnly")&&(e=b.setGridDisabledState(e,!1)),e=b.metaReducer.sf(e,"data.other.hidePopover",!1),e=b.reCaculateBalance(e,t.path.split(",")[1]),b.onEvent(e,"onEndEdit",t)},this.cancelEditAuxAccount=function(e,t){e=b.setGridDisabledState(e,!1),e=b.metaReducer.sf(e,"data.other.cancelEditAuxAccount",!0);var a=b.metaReducer.gf(e,"data.form.details"),n=parseInt(t.path.split(",")[1]);return a=a.set(n,a.get(n).set("accountingSubject",void 0)),e=b.metaReducer.sf(e,"data.form.details",a),e=b.metaReducer.sf(e,"curCellAuxAccountSubjects",void 0),e=b.metaReducer.sf(e,"curCellCodeAndName",void 0),e=b.setGridFocus(e,t.path)},this.onEvent=function(e,t,a){var n=void 0,r=void 0,c=void 0;if("onEndEdit"===t||"onBlur"===t){if(-1!=a.path.indexOf("root.children.details.columns.accountingSubject")){r=b.metaReducer.gf(e,"data.form.details"),n=parseInt(a.path.split(",")[1]),"onEndEdit"==t&&a.isChanged&&(r=r.set(n,r.get(n).set("accountingSubject",a.data)),e=b.metaReducer.sf(e,"data.form.details",r));var i=r.get(n),o=i.get("accountingSubject");if(c=i.get("quantityAndForeignCurrency")?i.get("quantityAndForeignCurrency").toJS():void 0,"onEndEdit"==t&&(e=b.metaReducer.sf(e,"isEdit",!1),a.data?o&&(o.get("isCalcQuantity")||o.get("isCalcMulti"))?e=b.checkQuantityAndForeignCurrency(e,a.path,o,c):(r=r.update(n,function(e){return e.set("quantityAndForeignCurrency",void 0)}),e=b.metaReducer.sf(e,"data.form.details",r)):o&&(o.get("isCalcQuantity")||o.get("isCalcMulti"))?e=b.checkQuantityAndForeignCurrency(e,a.path,o,c):(r=r.update(n,function(e){return e.set("quantityAndForeignCurrency",void 0)}),e=b.metaReducer.sf(e,"data.form.details",r))),"object"!=(void 0===o?"undefined":(0,C["default"])(o))&&(e=b.clearCell(e,"accountingSubject",n)),"onBlur"===t&&1==b.metaReducer.gf(e,"isEdit")||"recoverAuxItem"===a.recoverAuxItem){var u=b.metaReducer.gf(e,"curCellAuxAccountSubjects"),d=b.metaReducer.gf(e,"curCellCodeAndName");"object"==(void 0===o?"undefined":(0,C["default"])(o))&&u&&d&&o.get("code")==d.split(" ")[0]&&(r=(r=r.update(n,function(e){return e.setIn(["accountingSubject","auxAccountSubjects"],u)})).update(n,function(e){return e.setIn(["accountingSubject","codeAndName"],d)}),e=b.metaReducer.sf(e,"data.form.details",r),o=r.get(n).get("accountingSubject"))}if("object"==(void 0===o?"undefined":(0,C["default"])(o))&&o.get("isCalc")&&!o.get("auxAccountSubjects"))return e=b.startEditAuxAccount(e)}else if(-1!=a.path.indexOf("root.children.details.columns.debitAmount")||-1!=a.path.indexOf("root.children.details.columns.creditAmount")){var s=a.path.split(".cell.cell")[0].split("."),l=s[s.length-1];r=b.metaReducer.gf(e,"data.form.details"),n=parseInt(a.path.split(",")[1]);var f="-"==r.get(n).get(l)?0:r.get(n).get(l);if(f){e=b.rewriteQuantityAndCurrency(e,a.path);var m=f;m&&(m=parseFloat(m).toFixed(2)),r=(r=b.metaReducer.gf(e,"data.form.details")).update(n,function(e){return e.set(l,m)}),e=b.metaReducer.sf(e,"data.form.details",r)}}if("onEndEdit"===t&&a.path){if(-1!=a.path.indexOf("root.children.details.columns.accountingSubject")){if(n=parseInt(a.path.split(",")[1]),c=(r=b.metaReducer.gf(e,"data.form.details")).get(n).get("quantityAndForeignCurrency"),a.data&&a.data.get("auxAccountSubjects")){var g=a.data.get("auxAccountSubjects").get("inventory"),h=c?c.get("unitName"):void 0;g&&h&&h!=g.get("unitName")&&(r=r.update(n,function(e){return e.setIn(["quantityAndForeignCurrency","unitName"],g.get("unitName"))}),e=b.metaReducer.sf(e,"data.form.details",r))}if(c&&(c.get("isCalcMulti")||c.get("isCalcQuantity"))&&!a.arrowDirection)return e=b.metaReducer.sf(e,"data.other.isShow",!0),e=b.metaReducer.sf(e,"data.other.index",n),e=b.clearGridFocus(e);if(c&&(1==c.get("isCalcMulti")||1==c.get("isCalcQuantity"))&&a.arrowDirection==x.ARROWRIGHT)return e=b.metaReducer.sf(e,"data.other.isShow",!0),e=b.metaReducer.sf(e,"data.other.index",n),e=b.clearGridFocus(e)}r=b.metaReducer.gf(e,"data.form.details");var p=a.path,A=void 0;(A=b.getNextFocusCellPath(e,p))!=a.path&&(-1!=A.indexOf("root.children.details.columns.accountingSubject")&&(e=b.onFieldFocus(e,A)),e=b.setGridFocus(e,A)),e=b.checkRowState(e,A,a.isChanged||!1)}}else{if("endEditAuxAccount"===t){var S=a.path.split(",")[1],y=void 0;return(r=b.metaReducer.gf(e,"data.form.details")).get(S),y=r.get(S).get("accountingSubject"),e=b.endEditAuxAccount(e,a),e=1==y.get("isCalcMulti")||1==y.get("isCalcQuantity")?b.metaReducer.sf(e,"data.other.isShow",!0):b.metaReducer.sf(e,"data.other.isShow",!1),b.metaReducer.sf(e,"data.other.index",parseInt(a.path.split(",")[1]))}if("cancelEditAuxAccount"===t)e=b.cancelEditAuxAccount(e,a);else if("accountQuantityIsShow"===t)e=b.accountQuantityIsShow(e,a);else if("onShortcutKey"===t){!a.keyEvent||"="!=a.keyEvent.key&&187!=a.keyEvent.keyCode&&229!=a.keyEvent.keyCode?!a.keyEvent||"-"!=a.keyEvent.key&&189!=a.keyEvent.keyCode&&109!=a.keyEvent.keyCode?!a.keyEvent||" "!=a.keyEvent.key&&32!=a.keyEvent.keyCode||(e=b.toggleAmountDirection(e)):e=b.toggleAmountPositive(e):e=b.makeAmountEqual(e);var v=b.metaReducer.gf(e,"data.other.originalFieldPath");e=b.reCaculateBalance(e,v&&v.split(",")[1])}}return e},this.toggleAmountDirection=function(e){var t=b.metaReducer.gf(e,"data.other.focusFieldPath"),a=b.metaReducer.gf(e,"data.other.editStatus"),n=b.metaReducer.gf(e,"data.form.details"),r=parseInt(t.split(",")[1]);return-1!=t.indexOf("root.children.details.columns.debitAmount")?(n=n.update(r,function(e){return b.switchAmount(e)}),e=b.metaReducer.sf(e,"data.form.details",n),e=b.metaReducer.sf(e,"data.other.focusFieldPath",t.replace("debitAmount","creditAmount"))):-1!=t.indexOf("root.children.details.columns.creditAmount")&&(n=n.update(r,function(e){return b.switchAmount(e)}),e=b.metaReducer.sf(e,"data.form.details",n),e=b.metaReducer.sf(e,"data.other.focusFieldPath",t.replace("creditAmount","debitAmount"))),1!=a&&(e=b.metaReducer.sf(e,"data.other.editStatus",n.EDIT_STATUS)),e},this.switchAmount=function(e){var t=e.get("debitAmount");return e.set("debitAmount",e.get("creditAmount")).set("creditAmount",t)},this.onFieldFocus=function(e,t){var a=t.split(",")[1],n=b.metaReducer.gf(e,"data.form.details"),r=b.getTotalValue(n,"creditAmount"),c=b.getTotalValue(n,"debitAmount");if(-1!=t.indexOf("root.children.details.columns.accountingSubject")){var i=n.get(a);if(i.get("accountingSubject")){var o=i.get("accountingSubject").get("auxAccountSubjects"),u=i.get("accountingSubject").get("codeAndName");e=b.metaReducer.sf(e,"curCellAuxAccountSubjects",o),e=b.metaReducer.sf(e,"curCellCodeAndName",u),e=b.metaReducer.sf(e,"isEdit",!0),n=n.update(a,function(e){return e.setIn(["accountingSubject","auxAccountSubjects"],void 0)}),e=b.metaReducer.sf(e,"data.form.details",n)}}else if(-1<t.indexOf("root.children.details.columns.debitAmount")){var d=n.get(a).get("creditAmount"),s=n.get(a).get("debitAmount");"0"!=d&&"0.00"!=d||(d=""),"0"!=s&&"0.00"!=s||(s=""),c<r&&!d&&!s&&(e=b.makeAmountEqual(e),e=b.reCaculateBalance(e,t.split(",")[1]))}else if(-1<t.indexOf("root.children.details.columns.creditAmount")){var l=n.get(a).get("creditAmount"),f=n.get(a).get("debitAmount");"0"!=l&&"0.00"!=l||(l=""),"0"!=f&&"0.00"!=f||(f=""),r<c&&!l&&!f&&(e=b.makeAmountEqual(e),e=b.reCaculateBalance(e,t.split(",")[1]))}return e=b.checkRowState(e,t)},this.onFieldChange=function(e,t,a,n){var r=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];if(-1!=t.indexOf("root.children.details")){var c=b.metaReducer.gf(e,"data.other.editStatus");if(-1!=t.indexOf("root.children.details.columns.debitAmount")||-1!=t.indexOf("root.children.details.columns.creditAmount")){var i=t.split(".cell.cell")[0].split("."),o=i[i.length-1],u=parseInt(t.split(",")[1]);if(a=b.metaReducer.gf(e,"data.form.details").get(u).get(o),b.isEnterTestSign("=",a,n)&&1==r)e=b.makeAmountEqual(e),n=b.getNewValueAmount(e,t);else if(b.isEnterTestSign("-",a,n)&&1==r)e=b.toggleAmountPositive(e),n=b.getNewValueAmount(e,t);else{9999999999.99<n?n=9999999999.99:n<-9999999999.99&&(n=-9999999999.99),e=b.metaReducer.sf(e,"data.form.details."+u+"."+o,n);var d=b.metaReducer.gf(e,"data.form.details");e=b.getDebitAndCreditBalance(e,t,n,d)}e=b.reCaculateBalance(e,u)}else-1!=t.indexOf("root.children.details.columns.quantityAndForeignCurrency")?e=b.rewriteAmount(e,t,a,n):-1!=t.indexOf("root.children.details.columns.accountingSubject")&&"object"==(void 0===n?"undefined":(0,C["default"])(n))&&(e=b.checkQuantityAndForeignCurrency(e,t,n));a!=n&&(c!=x.EDIT_STATUS&&c!=x.VIEW_STATUS||(e=b.changeStatus(e,x.EDIT_STATUS)))}return e},this.reCaculateBalance=function(e,t,a){if(!b.metaReducer.gf(e,"data.form.details").get(t).get("accountingSubject"))return e;for(var n=b.metaReducer.gf(e,"data.form.details"),r=n.get(t).get("accountingSubject"),c=f["default"].number.transferData(r.get("initBalance")),i=0,o=void 0,u=0;u<n.size;u++)(o=n.get(u).get("accountingSubject"))&&o.get("code")==r.get("code")&&(!a||a&&t!=u)&&(o.get("isCalc")?o.get("isCalc")&&b.isEqualAuxAccountSubjects(o.get("auxAccountSubjects"),r.get("auxAccountSubjects"))&&(i=i+f["default"].number.transferData(n.get(u).get("debitAmount"))-f["default"].number.transferData(n.get(u).get("creditAmount"))):i=i+f["default"].number.transferData(n.get(u).get("debitAmount"))-f["default"].number.transferData(n.get(u).get("creditAmount")));c=b.toFixedLocal(c+i),console.log("balance: "+c);for(var d=0;d<n.size;d++)(o=n.get(d).get("accountingSubject"))&&o.get("code")==r.get("code")&&(!a||a&&t!=d)&&(o.get("isCalc")?o.get("isCalc")&&b.isEqualAuxAccountSubjects(o.get("auxAccountSubjects"),r.get("auxAccountSubjects"))&&(n=n.update(d,function(e){return e.setIn(["accountingSubject","balance"],c)})):n=n.update(d,function(e){return e.setIn(["accountingSubject","balance"],c)}));return e=b.metaReducer.sf(e,"data.form.details",n)},this.rewriteAmount=function(e,t,a,n){var r=t.split(",")[1],c=!0,i=b.metaReducer.gf(e,"data.form.details"),o=i.get(r),u=o.get("debitAmount"),d=o.get("creditAmount");if(0!=u)c=!0;else if(0!=d)c=!1;else{var s=o.get("accountingSubject");if(s.get("accountTypeId")==x.ACCOUNTTYPE_PROFITANDLOSS)c=0==s.get("balanceDirection");else if(0==r)c=!0;else{var l=i.get(r-1).get("debitAmount"),f=i.get(r-1).get("creditAmount");c=!!(0==b.getEqualAmount(e))||(0!=l||0==f)}}var m=n.get("amount"),g=c?t.replace("quantityAndForeignCurrency","debitAmount"):t.replace("quantityAndForeignCurrency","creditAmount");m&&(m=parseFloat(m).toFixed(2));return e=c?b.onFieldChange(e,"root.children.details.columns.debitAmount.cell.cell,"+r,o.get("debitAmount"),m,!1):b.onFieldChange(e,"root.children.details.columns.creditAmount.cell.cell,"+r,o.get("creditAmount"),m,!1),i=(i=b.metaReducer.gf(e,"data.form.details")).update(r,function(e){return e.set("quantityAndForeignCurrency",n)}),e=b.metaReducer.sf(e,"data.form.details",i),e=b.getDebitAndCreditBalance(e,g,m,i)},this.toggleAmountPositive=function(e){var t=b.metaReducer.gf(e,"data.other.focusFieldPath"),a=b.metaReducer.gf(e,"data.form.details"),n=b.metaReducer.gf(e,"data.other.editStatus"),r=parseInt(t.split(",")[1]);if(-1!=t.indexOf("root.children.details.columns.debitAmount")){a=a.update(r,function(e){return e.set("debitAmount",-parseFloat(f["default"].number.transferData(e.get("debitAmount"))))});var c=parseFloat(a.get(r).get("debitAmount"));e=b.getDebitAndCreditBalance(e,t,c,a)}else if(-1!=t.indexOf("root.children.details.columns.creditAmount")){a=a.update(r,function(e){return e.set("creditAmount",-parseFloat(f["default"].number.transferData(e.get("creditAmount"))))});var i=parseFloat(a.get(r).get("creditAmount"));e=b.getDebitAndCreditBalance(e,t,i,a)}return n!=a.ADD_STATUS&&(e=b.metaReducer.sf(e,"data.other.editStatus",a.EDIT_STATUS)),e},this.getDebitAndCreditBalance=function(e,t,c,a,n){var i=parseInt(t.split(",")[1]),r=b.metaReducer.gf(e,"data.other.editStatus"),o=0,u=0,d=0,s=0;if(!n){var l=void 0,f=void 0;if(-1!=t.indexOf("root.children.details.columns.debitAmount")){if(r==x.EDIT_STATUS){1==u&&o==u?c&&0!=c&&a.map(function(e,t){e.get("creditAmount")&&""!=e.get("creditAmount")&&(l=t,f=e.get("creditAmount"),a=a.update(t,function(e){return e.set("creditAmount",d)}))}):1==u&&u<o&&a.map(function(e,t){e.get("creditAmount")&&""!=e.get("creditAmount")&&(l=Number(t),a=a.update(t,function(e){return e.set("creditAmount",d)}))})}a=a.update(i,function(e){return e.set("creditAmount",0)}),e=b.metaReducer.sf(e,"data.form.details",a),"number"==typeof l&&(e=b.rewriteQuantityAndCurrency(e,"root.children.details.columns.creditAmount.cell.cell,"+l,f))}else-1!=t.indexOf("root.children.details.columns.creditAmount")&&(r==x.EDIT_STATUS&&(a.map(function(e,t){var a=parseInt((100*parseFloat(e.get("debitAmount")||0)).toFixed(0)),n=parseInt((100*parseFloat(e.get("creditAmount")||0)).toFixed(0));if(e.get("creditAmount")&&""!=e.get("creditAmount")||t==i){if(t!=i)s=(parseInt((100*s).toFixed(0))+n)/100;else if(t==i){var r=parseInt((100*parseFloat(c||0)).toFixed(0));s=(parseInt((100*s).toFixed(0))+r)/100}u+=1}e.get("debitAmount")&&""!=e.get("debitAmount")&&(o+=1,d=(parseInt((100*d).toFixed(0))+a)/100)}),1==o&&u==o?c&&0!=c&&!(0,m["default"])(s)&&a.map(function(e,t){e.get("debitAmount")&&""!=e.get("debitAmount")&&(l=t,f=e.get("debitAmount"),a=a.update(t,function(e){return e.set("debitAmount",s)}))}):1==o&&o<u&&!(0,m["default"])(s)&&a.map(function(e,t){e.get("debitAmount")&&""!=e.get("debitAmount")&&(l=Number(t),a=a.update(t,function(e){return e.set("debitAmount",s)}))})),a=a.update(i,function(e){return e.set("debitAmount",0)}),e=b.metaReducer.sf(e,"data.form.details",a),"number"==typeof l&&(e=b.rewriteQuantityAndCurrency(e,"root.children.details.columns.debitAmount.cell.cell,"+l,f)))}return e},this.isEnterTestSign=function(e,t,a){if(""==t||null==t)return!1;var n=void 0,r=!1;t=t.toString(),a=a.toString();for(var c=0;c<t.length;c++)n=t.substr(c,1),a=a.replace(n,"");return a==e&&(r=!0),r},this.makeAmountEqual=function(e){var t=b.metaReducer.gf(e,"data.other.focusFieldPath"),a=parseFloat(b.getEqualAmount(e)),n=b.metaReducer.gf(e,"data.form.details"),r=parseInt(t.split(",")[1]);return-1!=t.indexOf("root.children.details.columns.debitAmount")?(n=n.update(r,function(e){return e.set("debitAmount",-a).set("creditAmount",0)}),e=b.metaReducer.sf(e,"data.form.details",n)):-1!=t.indexOf("root.children.details.columns.creditAmount")&&(n=n.update(r,function(e){return e.set("creditAmount",a).set("debitAmount",0)}),e=b.metaReducer.sf(e,"data.form.details",n)),e},this.getEqualAmount=function(e){var t=b.metaReducer.gf(e,"data.form.details"),a=b.getTotalValue(t,"creditAmount"),n=b.getTotalValue(t,"debitAmount"),r=b.metaReducer.gf(e,"data.other.focusFieldPath");if(!r)return(n-a).toFixed(2);var c=parseInt(r.split(",")[1]),i=t.get(c),o=0,u=0;return-1!=r.indexOf("root.children.details.columns.debitAmount")?(o=parseFloat(i.get("debitAmount")),u=parseFloat(i.get("creditAmount"))):-1!=r.indexOf("root.children.details.columns.creditAmount")&&(u=parseFloat(i.get("creditAmount")),o=parseFloat(i.get("debitAmount"))),((n||0)-(a||0)-(o||0)+(u||0)).toFixed(2)},this.getNewValueAmount=function(e,t){var a=t.split(".cell.cell")[0].split("."),n=a[a.length-1],r=parseInt(t.split(",")[1]),c=b.metaReducer.gf(e,"data.form.details");return parseFloat(c.get(r).get(n)).toFixed(2)},this.getTotalValue=function(e,a){var n=0;return e.map(function(e,t){n+=parseFloat(e.get(a)||"0")}),("debitAmount"==a||"creditAmount"==a)&&99999999999.99<=n?n=99999999999.99:n},this.accountQuantityIsShow=function(e,t){var a=t.path,n=void 0;if(t.error)e=b.metaReducer.sf(e,"data.other.isShow",!0);else{if(-1!=t.path.indexOf("root.children.details.columns.quantityAndForeignCurrency")&&0!=t.isToNextCell){var r=b.metaReducer.gf(e,"data.form.details"),c=parseInt(t.path.split(",")[1]);if(1==r.get(c).getIn(["accountingSubject","balanceDirection"])){var i=b.getNextFocusCellPath(e,a);n=b.getNextFocusCellPath(e,i)}else n=b.getNextFocusCellPath(e,a);n!=t.path&&(e=b.setGridFocus(e,n)),e=b.checkRowState(e,n)}e=b.metaReducer.sf(e,"data.other.isShow",!1)}return e},this.checkRowState=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=parseInt(t.split(",")[1]),r=t.split(",")[0],c=b.metaReducer.gf(e,"data.form.details"),i=void 0;if(b.metaReducer.gf(e,"data.form.certificateStatus")==x.STATUS_VOUCHER_AUDITED||1==b.metaReducer.gf(e,"root.children.details.columns.creditAmount.isReadOnly"))return e;if(n==c.size-1&&(c=c.push((0,A.Map)(x.blankVoucherItem)),e=b.metaReducer.sf(e,"data.form.details",c),i=!0),-1!=r.indexOf("root.children.details.columns.summary"))if(0<n){var o=c.get(n-1);!c.get(n).get("summary")&&o.get("summary")&&(c=c.update(n,function(e){return e.set("summary",o.get("summary"))}),e=b.metaReducer.sf(e,"data.form.details",c),i=!0)}else 0==n&&(i=!1);return(i=1==a?a:i)&&b.metaReducer.gf(e,"data.other.editStatus")==x.VIEW_STATUS&&(e=b.changeStatus(e,x.EDIT_STATUS)),e},this.getNextFocusCellPath=function(e,t){if(-1==t.indexOf("root.children.details")||-1==t.indexOf(","))return t;for(var a=t.split(",")[1],n=x.getMeta().children[3].columns,r=t.split(".cell.cell")[0].split("."),c=r[r.length-1],i=void 0,o=void 0,u=0;u<n.length;u++)if(n[u].name===c){if(u==n.length-1)i=n[0].name,o=parseInt(a)+1;else{for(var d=u+1;d<n.length;d++)if(!n[d].disabled){i=n[d].name;break}o=a}break}return i&&o?t.split(",")[0].replace(c,i)+","+o:t},this.clearGridFocus=function(e){return b.metaReducer.sf(e,"data.other.focusFieldPath",void 0)},this.setGridFocus=function(e,t){return e=b.metaReducer.sf(e,"data.other.focusFieldPath",t)},this.clearCell=function(e,t,a){var n=b.metaReducer.gf(e,"data.form.details");return n=n.set(a,n.get(a).set(t,"")),b.metaReducer.sf(e,"data.form.details",n)},this.startEditAuxAccount=function(e){return e=b.setGridDisabledState(e,!0),e=b.metaReducer.sf(e,"data.other.hidePopover",!0),b.clearGridFocus(e)},this.moveRowToUpOrDown=function(e,t,a,n){var r=b.metaReducer.gf(e,"data.form."+t).toJS(),c=r[a],i=r[a-1];n==x.MOVEROW_UP?(c=r[a],i=r[a-1],r[a-1]=c,r[a]=i):n==x.MOVEROW_DOWN&&(c=r[a],i=r[a+1],r[a+1]=c,r[a]=i);var o=b.metaReducer.gf(e,"data.other.editStatus")==x.ADD_STATUS?x.ADD_STATUS:x.EDIT_STATUS;return e=b.metaReducer.sf(e,"data.form."+t,(0,A.fromJS)(r)),e=b.changeStatus(e,o,x.STATUS_VOUCHER_NOT_AUDITED)},this.addRowBefore=function(e,t,a){e=b.metaReducer.sf(e,"data.other.detailsScrollToRow",a+1);var n=b.metaReducer.gf(e,"data.other.editStatus")==x.ADD_STATUS?x.ADD_STATUS:x.EDIT_STATUS;return e=b.changeStatus(e,n,x.STATUS_VOUCHER_NOT_AUDITED)},this.delRowBefore=function(e,t,a){e=b.metaReducer.sf(e,"data.other.detailsScrollToRow",a);var n=b.metaReducer.gf(e,"data.form.details"),r=b.metaReducer.gf(e,"data.other.deletedCertificateItems"),c=n.get(a);c.get("id")&&(r||(r=(0,A.List)()),r=r.push(c),e=b.metaReducer.sf(e,"data.other.deletedCertificateItems",r)),e=b.reCaculateBalance(e,a,!0);var i=b.metaReducer.gf(e,"data.other.editStatus")==x.ADD_STATUS?x.ADD_STATUS:x.EDIT_STATUS;return e=b.changeStatus(e,i,x.STATUS_VOUCHER_NOT_AUDITED)},this.checkQuantityAndForeignCurrency=function(e,t,a,n){var r=parseInt(t.split(",")[1]);if(a.get("isCalcQuantity")||a.get("isCalcMulti")){var c=b.metaReducer.gf(e,"data.other.quantityAndCurrencyTitle"),i=b.getQuantityAndCurrentTitle(c,a),o=void 0,u=b.metaReducer.gf(e,"data.other.currencyDS");if(u&&(o=u.find(function(e){return e.get("id")==a.get("currencyId")})),n)n.isCalcMulti==a.get("isCalcMulti")&&n.isCalcQuantity==a.get("isCalcQuantity")||((n=x.blankQuantityAndForeignCurrency).isCalcMulti=a.get("isCalcMulti"),n.isCalcQuantity=a.get("isCalcQuantity"),n.unitName=a.get("unitName"),n.exchangeRate=a.get("exchangeRate")||1,n.currency=o?{id:o.get("id"),name:o.get("name"),exchangeRate:o.get("exchangeRate")||1,isBaseCurrency:o.get("isBaseCurrency")}:null);else{var d=b.metaReducer.gf(e,"data.form.details"),s=d.get(r).get("quantityAndForeignCurrency")?d.get(r).get("quantityAndForeignCurrency").toJS():void 0;if(s)(n=s).price=x.blankQuantityAndForeignCurrency.price,n.origAmount=x.blankQuantityAndForeignCurrency.origAmount,n.isCalcMulti=a.get("isCalcMulti"),n.isCalcQuantity=a.get("isCalcQuantity"),n.unitName=a.get("unitName"),n.exchangeRate=a.get("exchangeRate")||1,n.currency=o?{id:o.get("id"),name:o.get("name"),exchangeRate:o.get("exchangeRate")||1,isBaseCurrency:o.get("isBaseCurrency")}:null;else{var l=d.get(r).get("debitAmount"),f=d.get(r).get("creditAmount");(n=x.blankQuantityAndForeignCurrency).amount=l&&0!=l?l:f&&0!=f?f:l,n.isCalcMulti=a.get("isCalcMulti"),n.isCalcQuantity=a.get("isCalcQuantity"),n.unitName=a.get("unitName"),n.exchangeRate=a.get("exchangeRate")||1,n.currency=o?{id:o.get("id"),name:o.get("name"),exchangeRate:o.get("exchangeRate")||1,isBaseCurrency:o.get("isBaseCurrency")}:null}}e=b.saveQuantityAndForeignCurrency(e,i,r,(0,A.fromJS)(n))}else e=b.saveQuantityAndForeignCurrency(e,"",r,void 0);return e},this.saveQuantityAndForeignCurrency=function(e,t,a,n){n&&(e=b.enableQuantityAndForeignCurrency(e,t));var r=b.metaReducer.gf(e,"data.form.details"),c=r.get(a).get("debitAmount"),i=r.get(a).get("creditAmount"),o=void 0;return r=r.update(a,function(e){return e.set("quantityAndForeignCurrency",n)}),e=b.setIsFromTemplate(e,a,r),n&&(o=c&&0!=c?"root.children.details.columns.debitAmount.cell.cell,"+a:i&&0!=i?"root.children.details.columns.creditAmount.cell.cell,"+a:"root.children.details.columns.debitAmount.cell.cell,"+a,e=b.rewriteQuantityAndCurrency(e,o)),e},this.rewriteQuantityAndCurrency=function(e,t,a){var n=parseInt(t.split(",")[1]),r=b.metaReducer.gf(e,"data.form.details"),c=t.split(".cell.cell")[0].split("."),i=c[c.length-1],o=parseFloat(r.get(n).get(i));b.metaReducer.gf(e,"data.form.details."+n+"."+i);if((!a||a!=o)&&r.get(n).get("accountingSubject")&&(r.get(n).get("accountingSubject").get("isCalcQuantity")||r.get(n).get("accountingSubject").get("isCalcMulti"))){var u=r.get(n).get("quantityAndForeignCurrency")?r.get(n).get("quantityAndForeignCurrency").set("calcFromAmount",!0).set("externalAmount",o||0):r.get(n).get("quantityAndForeignCurrency");r=r.update(n,function(e){return e.set("quantityAndForeignCurrency",u)})}return b.metaReducer.sf(e,"data.form.details",r)},this.setIsFromTemplate=function(e,t,a){a||(a=b.metaReducer.gf(e,"data.form.details")),a=a.toJS();for(var n=0;n<a.length;n++){var r=a[n];(r.accountingSubject||r.summary||r.debitAmount||r.creditAmount)&&(r.isFromTemplate=!1)}return b.metaReducer.sf(e,"data.form.details",(0,A.fromJS)(a))},this.enableQuantityAndForeignCurrency=function(e,t){return b.metaReducer.sfs(e,{"data.other.quantityAndCurrencyTitle":t,"data.other.isDisplayQuantityColumn":!0,"data.other.quantityAndForeignCurrencyWidth":120,"data.other.summaryWidth":140})},this.getQuantityAndCurrentTitle=function(e,t){var a="";return e&&(-1!=e.indexOf("/")||"外币"==e&&t.get("isCalcQuantity")||"数量"==e&&t.get("isCalcMulti"))?a="数量/外币":(t.get("isCalcQuantity")&&(a="数量"),t.get("isCalcMulti")&&(a=a+(a?"/":"")+"外币")),a},this.setGridDisabledState=function(e,t){var a={"root.children.details.columns.summary.isReadOnly":t,"root.children.details.columns.accountingSubject.isReadOnly":t,"root.children.details.columns.debitAmount.isReadOnly":t,"root.children.details.columns.creditAmount.isReadOnly":t};return b.setMultiField(e,a)},this.isEqualAuxAccountSubjects=function(e,t){if(!e&&!t)return!0;if(e&&t){if(!b.isEqualAuxItemFile("department",e,t))return!1;if(!b.isEqualAuxItemFile("person",e,t))return!1;if(!b.isEqualAuxItemFile("customer",e,t))return!1;if(!b.isEqualAuxItemFile("supplier",e,t))return!1;if(!b.isEqualAuxItemFile("inventory",e,t))return!1;if(!b.isEqualAuxItemFile("project",e,t))return!1;if(!b.isEqualAuxItemFile("department",e,t))return!1;for(var a=1;a<=10;a++)if(!b.isEqualAuxItemFile("exCalc"+a,e,t))return!1}else if(e&&!t||!e&&t)return!1;return!0},this.changeStatus=function(e,t,a,n){return e=b.checkMetaDisable(e,t,a,n),e=b.metaReducer.sf(e,"data.other.editStatus",t||x.ADD_STATUS),e=b.metaReducer.sf(e,"data.form.certificateStatus",a||x.STATUS_VOUCHER_NOT_AUDITED),e=b.metaReducer.sf(e,"data.form.details",b.updateBalanceShowable(b.metaReducer.gf(e,"data.form.details"),t)),e=t!=x.VIEW_STATUS&&t!=x.EDIT_STATUS||a!=x.STATUS_VOUCHER_NOT_AUDITED?t!=x.VIEW_STATUS&&t!=x.EDIT_STATUS||a!=x.STATUS_VOUCHER_AUDITED?b.metaReducer.sf(e,"data.form.attachmentStatus",0):b.metaReducer.sf(e,"data.form.attachmentStatus",1):b.metaReducer.sf(e,"data.form.attachmentStatus",0)},this.changeAuditStatus=function(e,t,a,n){return t==x.STATUS_VOUCHER_AUDITED?(e=b.metaReducer.sf(e,"data.form.auditor",a.personname),e=b.metaReducer.sf(e,"data.form.auditorId",a.id)):(e=b.metaReducer.sf(e,"data.form.auditor",""),e=b.metaReducer.sf(e,"data.form.auditorId","")),e=b.metaReducer.sf(e,"data.form.ts",n),e=b.clearGridFocus(e),b.changeStatus(e,x.VIEW_STATUS,t)},this.checkMetaDisable=function(e,t,a,n){return a||(a=b.metaReducer.gf(e,"data.form.certificateStatus")),t==x.VIEW_STATUS&&a==x.STATUS_VOUCHER_AUDITED||n?(e=b.metaReducer.sfs(e,{"data.form.codeDisabled":!0,"data.form.dateDisabled":!0,"data.form.attachmentDisabled":!0}),e=b.setGridDisabledState(e,!0),e=b.metaReducer.sf(e,"data.other.hidePopover",!0),e=b.metaReducer.sf(e,"data.form.attachmentStatus",0)):(e=b.metaReducer.sfs(e,{"data.form.codeDisabled":!1,"data.form.dateDisabled":!1,"data.form.attachmentDisabled":!1}),e=b.setGridDisabledState(e,!1),e=b.metaReducer.sf(e,"data.other.hidePopover",!1),e=b.metaReducer.sf(e,"data.form.attachmentStatus",1)),e},this.setMultiField=function(t,a){a&&(0,c["default"])(a).forEach(function(e){t=b.metaReducer.sf(t,""+e,(0,A.fromJS)(a[e]))});var e=b.metaReducer;e.gf,e.sf;return t=b.metaReducer.sf(t,"data.form.status",128),t=b.metaReducer.sf(t,"data.form.attachmentStatus",0)},this.saveUpload=function(e,t){var a=[];return t&&0<t.length&&t.map(function(e){return a.push({alt:e.name||e.file.name,id:e.id,type:e.type||e.file.type,fileId:e.fileId,name:e.name||e.file.originalName,ts:e.ts||e.file.ts,accessUrl:e.accessUrl||e.file.accessUrl}),a}),e=b.metaReducer.sf(e,"data.form.attachmentFiles",(0,A.fromJS)(a))},this.convertToAttachmentFiles=function(e){var t=[];return e&&0<e.length&&e.map(function(e){return t.push({alt:e.name||e.file.name,id:e.id,type:e.type||e.file.type,fileId:e.fileId,name:e.name||e.file.originalName,ts:e.ts||e.file.ts,accessUrl:e.accessUrl||e.file.accessUrl}),t}),(0,A.fromJS)(t)},this.upload=function(e,t,a,n){var r=b.metaReducer.gf(e,"data.form.isAttachCount"),c=b.metaReducer.gf(e,"data.form.attachCount"),i=((0,A.List)(),[]);return t&&0<t.length&&t.map(function(e){return i.push({alt:e.name||e.file.name,id:e.id,type:e.type||e.file.type,fileId:e.fileId,name:e.name||e.file.originalName,ts:e.ts||e.file.ts,accessUrl:e.accessUrl||e.file.accessUrl}),i}),-1<n?e=b.metaReducer.sf(e,"data.form.attachCount",n):(r||t.length>=c)&&(e=b.metaReducer.sf(e,"data.form.attachCount",t.length)),a&&(e=b.metaReducer.sf(e,"data.form.ts",a)),e=b.metaReducer.sf(e,"data.form.adjunctInfo.album",t),e=b.metaReducer.sf(e,"data.form.adjunctInfo.adjunctSize",t.length),e=b.metaReducer.sf(e,"data.form.attachmentFiles",(0,A.fromJS)(i))},this.draginPrevRowSummary=function(e,t,a){var n=b.metaReducer.gf(e,"data.form.details"),r=n.get(t-1).get("summary");return n=n.update(t,function(e){return e.set("summary",r)}),e=b.metaReducer.sf(e,"data.form.details",n),b.metaReducer.gf(e,"data.other.editStatus")==x.VIEW_STATUS&&(e=b.changeStatus(e,x.EDIT_STATUS)),b.checkRowState(e,a)},this.setNextOrPrivDis=function(e,t){return"prevBtn"==t?(e=b.metaReducer.sf(e,"data.form.prevDisalbed",!0),e=b.metaReducer.sf(e,"data.form.nextDisalbed",!1)):"nextBtn"==t&&(e=b.metaReducer.sf(e,"data.form.prevDisalbed",!1),e=b.metaReducer.sf(e,"data.form.nextDisalbed",!0)),e},this.applySummaryTemplate=function(e,t,a){(0,A.List)();var n=!1,r="",c=b.metaReducer.gf(e,"data.form.details");"object"==(void 0===c?"undefined":(0,C["default"])(c))&&(c=c.toJS());var i=a;e=b.delRowBefore(e,"details",i),e=b.extendReducer.gridReducer.delRow(e,"details",i),c.splice(i,1);var o=!0,u=!1,d=void 0;try{for(var s,l=(0,p["default"])(t.get("entrys"));!(o=(s=l.next()).done);o=!0){var f=s.value,m=b.getVoucherItemFromEntry(e,f);m=m.set("isFromTemplate",!0),c.splice(i,0,m.toJS()),i++,(m.get("accountingSubject").get("isCalcMulti")||m.get("accountingSubject").get("isCalcQuantity"))&&(n=!0,r=b.getQuantityAndCurrentTitle(r,m.get("accountingSubject")))}}catch(e){u=!0,d=e}finally{try{!o&&l["return"]&&l["return"]()}finally{if(u)throw d}}n&&(e=b.enableQuantityAndForeignCurrency(e,r));for(var g=b.metaReducer.gf(e,"data.other.defaultLength");g<c.length;g++)""==c[g].summary&&(c.splice(g,1),g--);e=b.clearGridFocus(e),e=b.metaReducer.sf(e,"data.form.details",(0,A.fromJS)(c));for(var h=0;h<c.length;h++)e=b.reCaculateBalance(e,h);return e},this.applyCertificateTemplate=function(e,t){var a=(0,A.List)(),n=!1,r="",c=!0,i=!1,o=void 0;try{for(var u,d=(0,p["default"])(t.get("entrys"));!(c=(u=d.next()).done);c=!0){var s=u.value,l=b.getVoucherItemFromEntry(e,s);a=a.push(l),(l.get("accountingSubject").get("isCalcMulti")||l.get("accountingSubject").get("isCalcQuantity"))&&(n=!0,r=b.getQuantityAndCurrentTitle(r,l.get("accountingSubject")))}}catch(e){i=!0,o=e}finally{try{!c&&d["return"]&&d["return"]()}finally{if(i)throw o}}for(e=n?b.enableQuantityAndForeignCurrency(e,r):b.disableQuantityAndForeignCurrency(e);a.size<b.metaReducer.gf(e,"data.other.defaultLength");)a=a.push((0,A.Map)(x.blankVoucherItem));e=b.clearGridFocus(e),e=b.metaReducer.sf(e,"data.form.details",a);for(var f=0;f<a.size;f++)e=b.reCaculateBalance(e,f);return e},this.setAccoutingSubject=function(e,t,a,n){var r=b.metaReducer.gf(e,"data.form.details");return r=r.update(t,function(e){return e.set("accountingSubject",(0,A.Map)(n))}),e=b.metaReducer.sf(e,"data.form.details",r),e=b.metaReducer.sf(e,"data.other.focusCellPath","root.children.details.columns.accountingSubject.cell.cell,"+t),e=b.metaReducer.sf(e,"data.other.accountingSubjects",(0,A.fromJS)(a.glAccounts)),b.metaReducer.sf(e,"data.other.accountingSubjectsAll",(0,A.fromJS)(a.glAccountsAll))},this.showBtnState=function(e,t){var a=t.path,n=t.value;return b.metaReducer.sf(e,a,n)}},n);e.exports=t["default"]},1109:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(0),c=(n=r)&&n.__esModule?n:{"default":n},i=a(28);t["default"]={actionCreator:function(e){return{gridAction:new i.GridDecorator.action((0,c["default"])({},e,{gridOption:{details:{path:"data.form.details",selectFieldName:"selected",cellClassName:"ttk-voucher-app-document-cell",emptyRow:{},getColNames:function(e){return["summary","accountingSubject","debitAmount","creditAmount"]},cellIsReadonly:function(e,t,a){return!1}}}}))}},reducerCreator:function(e){return{gridReducer:new i.GridDecorator.reducer((0,c["default"])({},e,{gridOption:{details:{path:"data.form.details",selectFieldName:"selected",cellClassName:"ttk-voucher-app-document-cell",emptyRow:{},getColNames:function(e){return["summary","accountingSubject","debitAmount","creditAmount"]},cellIsReadonly:function(e,t,a){return!1}}}}))}}},e.exports=t["default"]},1160:function(e,t,a){e.exports={"default":a(1161),__esModule:!0}},1161:function(e,t,a){a(1162),e.exports=a(35).Number.isNaN},1162:function(e,t,a){var n=a(64);n(n.S,"Number",{isNaN:function(e){return e!=e}})}});