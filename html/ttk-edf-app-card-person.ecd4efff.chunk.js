webpackJsonp([59],{919:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a,n=p(r(0)),o=p(r(10)),s=p(r(7)),u=p(r(9)),i=p(r(11)),d=p(r(12)),c=r(2),f=(p(c),r(34)),m=p(r(354));function p(e){return e&&e.__esModule?e:{"default":e}}var l=(0,f.wrapper)(m["default"])(a=function(e){function t(){return(0,s["default"])(this,t),(0,i["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,d["default"])(t,e),(0,u["default"])(t,[{key:"render",value:function(){return this.props.monkeyKing((0,n["default"])({},this.props,{path:"root"}))}}]),t}(c.Component))||a;t["default"]=l,e.exports=t["default"]},920:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n,o=p(r(0)),u=p(r(84)),i=p(r(85)),s=p(r(7));t["default"]=function(e){var t=new d.action(e),r=m.FormDecorator.actionCreator((0,o["default"])({},e,{metaAction:t})),a=new l((0,o["default"])({},e,{metaAction:t,voucherAction:r})),n=(0,o["default"])({},t,r,a);return t.config({metaHandlers:n}),n};p(r(2));var d=r(34),c=r(13),f=(p(r(14)),p(r(212))),m=r(48);function p(e){return e&&e.__esModule?e:{"default":e}}var l=(a=function e(t){(0,s["default"])(this,e),n.call(this),this.metaAction=t.metaAction,this.voucherAction=t.voucherAction,this.config=f["default"].current,this.webapi=this.config.webapi},n=function(){var t,r,s=this;this.onInit=function(e){var t=e.component,r=e.injections;s.voucherAction.onInit({component:t,injections:r}),s.component=t,s.injections=r,s.component.props.setOkListener&&s.component.props.setOkListener(s.onOk),r.reduce("init",{isPop:s.component.props.isPop}),s.load()},this.load=(0,i["default"])(u["default"].mark(function e(){var t,r,a,n;return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},a=r=void 0,e.next=3,s.webapi.person.queryData();case 3:if((n=e.sent)&&(t.queryData=n),!s.component.props.personId&&0!=s.component.props.personId){e.next=12;break}return e.next=8,s.webapi.person.query(s.component.props.personId);case 8:(r=e.sent)&&(t.person=r),e.next=13;break;case 12:s.component.props.dept&&(t.parentPerson=s.component.props.dept);case 13:return e.next=15,s.webapi.role.query();case 15:(a=e.sent)&&0<a.length&&a.forEach(function(e){e.label=e.name,e.value=e.id}),s.injections.reduce("load",t,a),s.metaAction.gf("data.form").toJS();case 19:case"end":return e.stop()}},e,s)})),this.onOk=(0,i["default"])(u["default"].mark(function e(){return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.save();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,s)})),this.save=(0,i["default"])(u["default"].mark(function e(){var t,r,a;return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.metaAction.gf("data.form").toJS(),e.next=3,s.voucherAction.check([{path:"data.form.email",value:t.email},{path:"data.form.name",value:t.name},{path:"data.form.identityCard",value:t.identityCard},{path:"data.form.department",value:t.department},{path:"data.form.mobile",value:t.mobile}],s.check);case 3:if(e.sent){e.next=7;break}return s.metaAction.toast("warning","请按页面提示信息修改信息后才可提交"),e.abrupt("return",!1);case 7:if(!t.userId){e.next=11;break}if(!(t.roleDtoList.length<=0)){e.next=11;break}return s.metaAction.toast("warning","已经邀请的用户不允许清空角色！"),e.abrupt("return",!1);case 11:if(r=void 0,(a=s.metaAction.context.get("currentOrg")||{}).id="genid",t.creator=a.creator,t.department&&(t.departmentId=t.department.id,t.departmentName=t.department.name,delete t.department),t.mobile&&(t.mobile=t.mobile.toString()),t.name=t.name?t.name.trim():"",t.jobDuty=t.jobDuty?t.jobDuty.trim():"",t.isReturnValue=!0,!s.component.props.personId&&0!=s.component.props.personId){e.next=27;break}return t.personId=s.component.props.personId,e.next=24,s.webapi.person.update(t);case 24:r=e.sent,e.next=31;break;case 27:return t.isEnable=!0,e.next=30,s.webapi.person.create(t);case 30:r=e.sent;case 31:if(!r||!r.error){e.next=36;break}return s.metaAction.toast("error",r.error.message),e.abrupt("return",!1);case 36:return s.metaAction.toast("success","保存成功"),e.abrupt("return",r);case 38:case"end":return e.stop()}},e,s)})),this.changeCheck=function(){var e=s.metaAction.gf("data.form").toJS();s.voucherAction.check([{path:"data.form.name",value:e.name}],s.check)},this.check=(t=(0,i["default"])(u["default"].mark(function e(t){var r,a,n,o;return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.path){e.next=2;break}return e.abrupt("return");case 2:if(r=/^1[3|4|5|7|8][0-9]\d{8}$/,a=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,n=/^\d{17}(\d|x)$/i,o=void 0,"data.form.mobile"!=t.path){e.next=16;break}if(!t.value||!r.test(t.value)){e.next=12;break}if(0!=s.metaAction.gf("data.phoneStatus")){e.next=10;break}return e.next=8,s.webapi.user.existsMobile(t.value);case 8:return o=e.sent,e.abrupt("return",{errorPath:"data.other.error.mobile",message:o?"手机号已注册":""});case 10:e.next=14;break;case 12:if(!t.value||r.test(t.value)){e.next=14;break}return e.abrupt("return",{errorPath:"data.other.error.mobile",message:t.value&&!r.test(t.value)?"请输入11位的手机号":""});case 14:e.next=30;break;case 16:if("data.form.email"!=t.path){e.next=20;break}return e.abrupt("return",{errorPath:"data.other.error.email",message:t.value&&!a.test(t.value)?"请输入正确格式的邮箱":""});case 20:if("data.form.name"!=t.path){e.next=24;break}return e.abrupt("return",{errorPath:"data.other.error.name",message:t.value&&t.value.trim()?"":"请录入姓名"});case 24:if("data.form.identityCard"!=t.path){e.next=28;break}return e.abrupt("return",{errorPath:"data.other.error.identityCard",message:t.value&&!n.test(t.value)?"请输入正确的身份证号":""});case 28:if("data.form.department"!=t.path){e.next=30;break}return e.abrupt("return",{errorPath:"data.other.error.department",message:t.value?"":"请录入所属部门"});case 30:case"end":return e.stop()}},e,s)})),function(e){return t.apply(this,arguments)}),this.checkNoSave=(r=(0,i["default"])(u["default"].mark(function e(t){var r,a;return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.path){e.next=2;break}return e.abrupt("return");case 2:if(r=/^1[3|4|5|7|8][0-9]\d{8}$/,/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,/^\d{17}(\d|x)$/i,a=void 0,"data.form.mobile"!=t.path){e.next=27;break}if(!t.value){e.next=25;break}if(!r.test(t.value)){e.next=12;break}return e.next=8,s.webapi.user.existsMobile(t.value);case 8:return a=e.sent,e.abrupt("return",{errorPath:"data.other.error.mobile",message:a?"手机号已注册":""});case 12:if(!(11<t.value.length)){e.next=16;break}return e.abrupt("return",{errorPath:"data.other.error.mobile",message:"请输入正确位数的手机号"});case 16:if(!(1<t.value.length&&t.value.length<11)||/^1[3|4|5|8|7]/.test(t.value)){e.next=20;break}return e.abrupt("return",{errorPath:"data.other.error.mobile",message:"请输入正确的手机号"});case 20:if(1!=t.value.length||"1"==t.value){e.next=24;break}return e.abrupt("return",{errorPath:"data.other.error.mobile",message:"请输入正确的手机号"});case 24:return e.abrupt("return",{errorPath:"data.other.error.mobile",message:""});case 25:e.next=41;break;case 27:if("data.form.email"!=t.path){e.next=31;break}return e.abrupt("return",{errorPath:"data.other.error.email",message:""});case 31:if("data.form.name"!=t.path){e.next=35;break}return e.abrupt("return",{errorPath:"data.other.error.name",message:t.value&&t.value.trim()?"":"请录入姓名"});case 35:if("data.form.identityCard"!=t.path){e.next=39;break}return e.abrupt("return",{errorPath:"data.other.error.identityCard",message:t.value&&18<t.value.length?"请输入正确的的身份证号":""});case 39:if("data.form.department"!=t.path){e.next=41;break}return e.abrupt("return",{errorPath:"data.other.error.department",message:t.value?"":"请录入所属部门"});case 41:case"end":return e.stop()}},e,s)})),function(e){return r.apply(this,arguments)}),this.checkBoxChange=function(e){s.injections.reduce("roleChange",e)},this.roleDisable=function(){var e=s.metaAction.gf("data").toJS(),t=e.form,r=(e.roleStatus,!1);return t&&1==t.isOrgCreator&&(r=!0),r},this.fieldChange=function(e,t){s.voucherAction.fieldChange(e,t,s.checkNoSave)},this.departmentChange=function(e,r){var t=s.metaAction.gf("data.other.departments").toJS(),a=void 0;t.map(function(e,t){e.id==r&&(a=t)}),s.metaAction.sf("data.form.deptName",(0,c.fromJS)(t[a].name)),s.metaAction.sf("data.form.orgId",(0,c.fromJS)(t[a].orgId)),s.voucherAction.fieldChange(e,r,s.check)},this.addDepartment=(0,i["default"])(u["default"].mark(function e(){var t,r;return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.metaAction.modal("show",{title:"新增部门",width:400,children:s.metaAction.loadApp("app-card-department",{store:s.component.props.store})});case 2:if(!(t=e.sent)){e.next=11;break}return e.next=6,s.webapi.person.queryData();case 6:r=e.sent,s.injections.reduce("departmentList",r),s.metaAction.sf("data.form.departmentId",(0,c.fromJS)(t.id)),s.metaAction.sf("data.form.deptName",(0,c.fromJS)(t.name)),s.metaAction.sf("data.form.orgId",(0,c.fromJS)(t.orgId));case 11:case"end":return e.stop()}},e,s)})),this.roleMenuClick=function(e){switch(e.key){case"viewrole":s.viewRole()}},this.viewRole=(0,i["default"])(u["default"].mark(function e(){return u["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}))},a);e.exports=t["default"]},921:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n,o=d(r(0)),s=d(r(7));t["default"]=function(e){var t=new u.reducer(e),r=new c((0,o["default"])({},e,{metaReducer:t}));return(0,o["default"])({},t,r)};var p=r(13),u=r(34),i=(d(r(212)),d(r(14)),r(355));function d(e){return e&&e.__esModule?e:{"default":e}}var c=(a=function e(t){(0,s["default"])(this,e),n.call(this),this.metaReducer=t.metaReducer},n=function(){var m=this;this.init=function(e,t){return m.metaReducer.init(e,(0,i.getInitState)(t))},this.load=function(e,t,r){if(t.person){if(null===t.person.mobile&&(t.person.mobile=""),e=m.metaReducer.sf(e,"data.form",(0,p.fromJS)(t.person)),t.person.roleDtoList.length<1&&(e=m.metaReducer.sf(e,"data.roleStatus",!1)),t.person.roleDtoList&&0<t.person.roleDtoList.length){var a=[],n=[];t.person.roleDtoList.forEach(function(e){a.push({roleId:e.roleId}),n.push(e.roleId)}),e=m.metaReducer.sf(e,"data.form.roleDtoList",(0,p.fromJS)(a)),e=m.metaReducer.sf(e,"data.form.roleDtoListCheck",(0,p.fromJS)(n))}if(t.person.departmentId){var o=void 0;t.queryData.departmentList.forEach(function(e){e.id!=t.person.departmentId||(o=e.name)}),e=m.metaReducer.sf(e,"data.form.department",(0,p.fromJS)({id:t.person.departmentId,name:o}))}}if(t.parentPerson&&(e=m.metaReducer.sf(e,"data.form.department",(0,p.fromJS)(t.parentPerson))),t.queryData){var s=t.queryData;if(s.departmentList&&(e=m.metaReducer.sf(e,"data.other.departmentList",(0,p.fromJS)(s.departmentList))),s.employeeList&&s.employeeList.length){var u=s.employeeList.map(function(e){return{label:e.name,value:e.id}});t.person||(e=m.metaReducer.sf(e,"data.form.employee",(0,p.fromJS)(u[0]&&u[0].value))),e=m.metaReducer.sf(e,"data.other.employeeList",(0,p.fromJS)(u))}if(s.maritalstatuxList&&s.maritalstatuxList.length){var i=s.maritalstatuxList.map(function(e){return{label:e.name,value:e.id}});t.person||(e=m.metaReducer.sf(e,"data.form.maritalStatus",(0,p.fromJS)(i[2]&&i[2].value))),e=m.metaReducer.sf(e,"data.other.maritalstatuxList",(0,p.fromJS)(i))}if(s.sexList&&s.sexList.length){var d=s.sexList.map(function(e){return{label:e.name,value:e.id}});t.person||(e=m.metaReducer.sf(e,"data.form.gender",(0,p.fromJS)(d[2]&&d[2].value))),e=m.metaReducer.sf(e,"data.other.sexList",(0,p.fromJS)(d))}}if(r){if(t.person&&t.person.roleDtoList&&0<t.person.roleDtoList.length){var c=m.metaReducer.gf(e,"data.form.roleDtoListCheck").toJS(),f=!1;c.forEach(function(e){"1"==e&&(f=!0)}),r.forEach(function(e){f?"001"!=e.code&&(e.disabled=!0):"001"==e.code&&(e.disabled=!0)})}e=m.metaReducer.sf(e,"data.other.roles",(0,p.fromJS)(r))}return e},this.roleChange=function(e,t){var r=m.metaReducer.gf(e,"data.other.roles").toJS(),a=[],n=[],o=!1;return t.forEach(function(e){a.push({roleId:e}),n.push(e),"1"==e&&(o=!0)}),r.forEach(function(e){0<t.length?o?"001"!=e.code&&(e.disabled=!0):"001"==e.code&&(e.disabled=!0):e.disabled=!1}),e=m.metaReducer.sf(e,"data.other.roles",(0,p.fromJS)(r)),e=m.metaReducer.sf(e,"data.form.roleDtoList",(0,p.fromJS)(a)),e=m.metaReducer.sf(e,"data.form.roleDtoListCheck",(0,p.fromJS)(n))},this.departmentList=function(e,t){return e=m.metaReducer.sf(e,"data.other.departmentList",(0,p.fromJS)(t.departmentList))}},a);e.exports=t["default"]}});